import{u as E,m as A,n as R,k as G,j as e,L as H,C as b,B as P}from"./index-DYPp-ivU.js";import{r,d as I}from"./vendor-BOKTEpvH.js";import{D as y}from"./DashboardLayout-CKQImzu3.js";import{V as U}from"./VesselList-Bq5PBOp2.js";import{D as $}from"./DateRangePicker-D0mmnk8J.js";import{E as W}from"./ErrorDisplay-CLSu7BDk.js";import{E as B,g as V}from"./excelReportGenerator-Dec86p7h.js";import{j as O,f as z,S as M,C as Q}from"./ui-WwCSzw8y.js";import"./SearchFilter-Ce2dtUoQ.js";import"./StatusBadge-dur_AQpe.js";import"./formatters-CaoZFZze.js";import"./excelExport-Be0WQBzE.js";const q=()=>{const{currentUser:n}=E(),[j,s]=r.useState(null),[g,a]=r.useState(!0),[D,d]=r.useState(null);return r.useEffect(()=>{(async()=>{if(!n){a(!1);return}try{a(!0),d(null);const l=await A(n.uid);if(!l){d("User is not associated with any port"),a(!1);return}const t=await R(l);if(!t){d("Port data not found"),a(!1);return}s(t)}catch(l){console.error("Error in usePortData hook:",l),d("Failed to load port information")}finally{a(!1)}})()},[n]),{portData:j,loading:g,error:D}},J=n=>{const[j,s]=r.useState([]),[g,a]=r.useState(!0),[D,d]=r.useState(null);return r.useEffect(()=>{n?(async()=>{try{if(a(!0),d(null),n){const l=await G(n);s(l)}else s([])}catch(l){console.error("Error in useVessels hook:",l),d("Failed to load vessel data")}finally{a(!1)}})():(a(!1),s([]))},[n]),{vessels:j,loading:g,error:D,setVessels:s}},le=()=>{const n=I(),{currentUser:j}=E(),{portData:s,loading:g,error:a}=q(),[D,d]=r.useState(void 0),[o,l]=r.useState(""),[t,S]=r.useState("");r.useEffect(()=>{s&&s.id&&d(s.id)},[s]);const{vessels:v,loading:L,error:k}=J(D),N=r.useMemo(()=>v.filter(h=>{if(!o&&!t)return!0;const i=h.arrivalDateTime?new Date(h.arrivalDateTime.seconds*1e3):null;if(!i)return!0;const u=o?new Date(o):null,c=t?new Date(t):null;return u&&c?(c.setHours(23,59,59,999),i>=u&&i<=c):u?i>=u:c?(c.setHours(23,59,59,999),i<=c):!0}),[v,o,t]),C=()=>{n("/add-vessel")},T=h=>{const i=new Date,u=new Date(i.getTime()-7*24*60*60*1e3),c=v.filter(w=>{const m=w.arrivalDateTime;if(!m)return!1;let f;if(typeof m=="string")f=new Date(m);else if(m instanceof Date)f=m;else if(m.seconds)f=new Date(m.seconds*1e3);else return!1;return f>=u&&f<=i});V(c,(s==null?void 0:s.portName)||"Port","weekly",void 0,void 0,!1)},F=(h,i,u)=>{const c=new Date(h);c.setHours(0,0,0,0);const w=new Date(i);w.setHours(23,59,59,999);const m=v.filter(f=>{const x=f.arrivalDateTime;if(!x)return!1;let p;if(typeof x=="string")p=new Date(x);else if(x instanceof Date)p=x;else if(x.seconds)p=new Date(x.seconds*1e3);else return!1;return p>=c&&p<=w});V(m,(s==null?void 0:s.portName)||"Port","custom",h,i,!1)};return g?e.jsx(y,{title:"Port Dashboard",children:e.jsx(H,{message:"Loading port data..."})}):a?e.jsx(y,{title:"Port Dashboard",children:e.jsx(W,{message:a})}):e.jsxs(y,{title:"Port Dashboard",children:[e.jsx("div",{className:"mb-6",children:e.jsx(b,{title:`Welcome, ${s==null?void 0:s.portName}`,icon:e.jsx(M,{className:"h-6 w-6 text-seagreen-600"}),children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 mb-4",children:"Welcome to your port management dashboard. Here you can manage your vessels and view port information."}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsx(P,{onClick:C,icon:e.jsx(O,{className:"h-4 w-4"}),children:"Add New Vessel"}),e.jsx(P,{variant:"outline",onClick:()=>n("/port-profile"),icon:e.jsx(z,{className:"h-4 w-4"}),children:"View Port Profile"})]})]}),e.jsxs("div",{className:"mt-4 md:mt-0 bg-seagreen-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-sm font-medium text-seagreen-800",children:"Quick Stats"}),e.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-seagreen-600",children:"Total Vessels"}),e.jsx("p",{className:"text-2xl font-bold text-seagreen-900",children:N.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-seagreen-600",children:"Last Updated"}),e.jsx("p",{className:"text-sm font-medium text-seagreen-900",children:new Date().toLocaleDateString()})]})]})]})]})})}),e.jsx(B,{onGenerateWeekly:T,onGenerateCustom:F,ports:s?[{id:s.id,portName:s.portName}]:[],selectedPortId:s==null?void 0:s.id,isAdmin:!1}),e.jsxs(b,{title:"Filter Vessels",icon:e.jsx(Q,{className:"h-6 w-6 text-seagreen-600"}),className:"mb-6",children:[e.jsx($,{fromDate:o,toDate:t,onFromDateChange:l,onToDateChange:S,fromLabel:"From Arrival Date",toLabel:"To Arrival Date"}),(o||t)&&e.jsxs("div",{className:"mt-4 flex items-center justify-between bg-seagreen-50 p-3 rounded-lg",children:[e.jsxs("p",{className:"text-sm text-seagreen-700",children:["Showing ",N.length," vessels",o&&t?` from ${new Date(o).toLocaleDateString()} to ${new Date(t).toLocaleDateString()}`:o?` from ${new Date(o).toLocaleDateString()}`:t?` until ${new Date(t).toLocaleDateString()}`:""]}),e.jsx(P,{variant:"outline",size:"small",onClick:()=>{l(""),S("")},children:"Clear Filters"})]})]}),e.jsx(U,{vessels:N,loading:L,error:k})]})};export{le as default};
//# sourceMappingURL=PortDashboard-mdpPnNTa.js.map
