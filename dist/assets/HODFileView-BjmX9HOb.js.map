{"version":3,"file":"HODFileView-BjmX9HOb.js","sources":["../../src/pages/HODFileView.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { Download, Eye, File, Calendar, AlertCircle } from 'lucide-react';\r\nimport { toast } from 'react-toastify';\r\nimport DashboardLayout from '../components/layout/DashboardLayout';\r\nimport { fetchPorts, fetchFiles } from '../services/api';\r\nimport { Port, UploadedFile } from '../types';\r\nimport LoadingSpinner from '../components/ui/LoadingSpinner';\r\nimport Card from '../components/ui/Card';\r\n\r\nconst HODFileView: React.FC = () => {\r\n  const [ports, setPorts] = useState<Port[]>([]);\r\n  const [selectedPortId, setSelectedPortId] = useState<string>('');\r\n  const [selectedYear, setSelectedYear] = useState<number>(new Date().getFullYear());\r\n  const [selectedMonth, setSelectedMonth] = useState<number>(new Date().getMonth() + 1);\r\n  const [files, setFiles] = useState<UploadedFile[]>([]);\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  const months = [\r\n    'January', 'February', 'March', 'April', 'May', 'June',\r\n    'July', 'August', 'September', 'October', 'November', 'December'\r\n  ];\r\n\r\n  const years = Array.from({ length: 10 }, (_, i) => new Date().getFullYear() - i);\r\n\r\n  useEffect(() => {\r\n    loadPorts();\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (selectedPortId && selectedYear && selectedMonth) {\r\n      loadFiles();\r\n    } else {\r\n      setFiles([]);\r\n    }\r\n  }, [selectedPortId, selectedYear, selectedMonth]);\r\n\r\n  const loadPorts = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const portsData = await fetchPorts();\r\n      setPorts(portsData);\r\n    } catch (error) {\r\n      console.error('Error loading ports:', error);\r\n      toast.error('Failed to load ports');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const loadFiles = async () => {\r\n    if (!selectedPortId) return;\r\n    try {\r\n      setLoading(true);\r\n      const filesData = await fetchFiles(selectedPortId, selectedYear, selectedMonth);\r\n      setFiles(filesData);\r\n    } catch (error) {\r\n      console.error('Error loading files:', error);\r\n      toast.error('Failed to load files');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleDownload = (file: UploadedFile) => {\r\n    const link = document.createElement('a');\r\n    link.href = file.url;\r\n    link.download = file.originalFileName;\r\n    document.body.appendChild(link);\r\n    link.click();\r\n    document.body.removeChild(link);\r\n  };\r\n\r\n  const formatFileSize = (bytes: number): string => {\r\n    if (bytes === 0) return '0 Bytes';\r\n    const k = 1024;\r\n    const sizes = ['Bytes', 'KB', 'MB', 'GB'];\r\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\r\n    return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];\r\n  };\r\n\r\n  const formatDate = (timestamp: any) => {\r\n    if (!timestamp) return 'N/A';\r\n    const date = timestamp.toDate ? timestamp.toDate() : new Date(timestamp);\r\n    return new Intl.DateTimeFormat('en-US', {\r\n      year: 'numeric',\r\n      month: 'long',\r\n      day: 'numeric',\r\n      hour: '2-digit',\r\n      minute: '2-digit'\r\n    }).format(date);\r\n  };\r\n\r\n  return (\r\n    <DashboardLayout \r\n      title=\"View Files\" \r\n      subtitle=\"View and download files by Port, Year, and Month (Read-only access)\"\r\n    >\r\n      <div className=\"space-y-6\">\r\n        {/* Selection Section */}\r\n        <Card title=\"Select Port, Year & Month\" icon={<Calendar className=\"h-6 w-6 text-seagreen-600\" />}>\r\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n            <div>\r\n              <label className=\"block text-sm font-semibold text-gray-700 mb-2\">\r\n                Port\r\n              </label>\r\n              <select\r\n                value={selectedPortId}\r\n                onChange={(e) => setSelectedPortId(e.target.value)}\r\n                className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-seagreen-500 focus:border-seagreen-500\"\r\n              >\r\n                <option value=\"\">Select Port</option>\r\n                {ports.map((port) => (\r\n                  <option key={port.id} value={port.id}>\r\n                    {port.portName}\r\n                  </option>\r\n                ))}\r\n              </select>\r\n            </div>\r\n\r\n            <div>\r\n              <label className=\"block text-sm font-semibold text-gray-700 mb-2\">\r\n                Year\r\n              </label>\r\n              <select\r\n                value={selectedYear}\r\n                onChange={(e) => setSelectedYear(Number(e.target.value))}\r\n                className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-seagreen-500 focus:border-seagreen-500\"\r\n              >\r\n                {years.map((year) => (\r\n                  <option key={year} value={year}>\r\n                    {year}\r\n                  </option>\r\n                ))}\r\n              </select>\r\n            </div>\r\n\r\n            <div>\r\n              <label className=\"block text-sm font-semibold text-gray-700 mb-2\">\r\n                Month\r\n              </label>\r\n              <select\r\n                value={selectedMonth}\r\n                onChange={(e) => setSelectedMonth(Number(e.target.value))}\r\n                className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-seagreen-500 focus:border-seagreen-500\"\r\n              >\r\n                {months.map((month, index) => (\r\n                  <option key={index + 1} value={index + 1}>\r\n                    {month}\r\n                  </option>\r\n                ))}\r\n              </select>\r\n            </div>\r\n          </div>\r\n        </Card>\r\n\r\n        {/* Read-only Notice */}\r\n        <div className=\"bg-amber-50 border border-amber-200 rounded-lg p-4\">\r\n          <div className=\"flex\">\r\n            <AlertCircle className=\"h-6 w-6 text-amber-600 mr-3 flex-shrink-0\" />\r\n            <div>\r\n              <h3 className=\"font-medium text-amber-800\">Read-Only Access</h3>\r\n              <p className=\"mt-1 text-sm text-amber-700\">\r\n                You have view and download access only. You cannot upload, edit, or delete files.\r\n              </p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Files List */}\r\n        {selectedPortId && (\r\n          <Card \r\n            title={`Files - ${months[selectedMonth - 1]} ${selectedYear}`}\r\n            icon={<File className=\"h-6 w-6 text-seagreen-600\" />}\r\n          >\r\n            {loading ? (\r\n              <LoadingSpinner message=\"Loading files...\" />\r\n            ) : files.length === 0 ? (\r\n              <div className=\"text-center py-12\">\r\n                <File className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\r\n                <p className=\"text-gray-600\">No files available for this period</p>\r\n              </div>\r\n            ) : (\r\n              <div className=\"space-y-4\">\r\n                {files.map((file) => (\r\n                  <div\r\n                    key={file.id}\r\n                    className=\"bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow\"\r\n                  >\r\n                    <div className=\"flex items-start justify-between gap-4\">\r\n                      <div className=\"flex-1 min-w-0\">\r\n                        <div className=\"flex items-center gap-2 mb-2\">\r\n                          <File className=\"h-5 w-5 text-seagreen-600 flex-shrink-0\" />\r\n                          <h4 className=\"font-semibold text-gray-900 truncate\">\r\n                            {file.originalFileName}\r\n                          </h4>\r\n                        </div>\r\n                        \r\n                        {file.description && (\r\n                          <p className=\"text-sm text-gray-600 mb-2\">\r\n                            {file.description}\r\n                          </p>\r\n                        )}\r\n\r\n                        <div className=\"flex items-center gap-4 text-xs text-gray-500\">\r\n                          <span>{formatFileSize(file.fileSize)}</span>\r\n                          <span>â€¢</span>\r\n                          <span>Uploaded {formatDate(file.uploadedAt)}</span>\r\n                        </div>\r\n                      </div>\r\n\r\n                      <div className=\"flex items-center gap-2 flex-shrink-0\">\r\n                        <a\r\n                          href={file.url}\r\n                          target=\"_blank\"\r\n                          rel=\"noopener noreferrer\"\r\n                          className=\"p-2 text-seagreen-600 hover:bg-seagreen-50 rounded-lg transition-colors\"\r\n                          title=\"View\"\r\n                        >\r\n                          <Eye className=\"h-5 w-5\" />\r\n                        </a>\r\n                        <button\r\n                          onClick={() => handleDownload(file)}\r\n                          className=\"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors\"\r\n                          title=\"Download\"\r\n                        >\r\n                          <Download className=\"h-5 w-5\" />\r\n                        </button>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            )}\r\n          </Card>\r\n        )}\r\n\r\n        {!selectedPortId && (\r\n          <div className=\"bg-seagreen-50 border border-seagreen-200 rounded-lg p-4\">\r\n            <div className=\"flex\">\r\n              <AlertCircle className=\"h-6 w-6 text-seagreen-600 mr-3 flex-shrink-0\" />\r\n              <div>\r\n                <h3 className=\"font-medium text-seagreen-800\">Select Port, Year & Month</h3>\r\n                <p className=\"mt-1 text-sm text-seagreen-700\">\r\n                  Please select a port, year, and month to view files.\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </DashboardLayout>\r\n  );\r\n};\r\n\r\nexport default HODFileView;\r\n\r\n"],"names":["HODFileView","ports","setPorts","useState","selectedPortId","setSelectedPortId","selectedYear","setSelectedYear","selectedMonth","setSelectedMonth","files","setFiles","loading","setLoading","months","years","_","i","useEffect","loadPorts","loadFiles","portsData","fetchPorts","error","toast","filesData","fetchFiles","handleDownload","file","link","formatFileSize","bytes","k","sizes","formatDate","timestamp","date","jsx","DashboardLayout","jsxs","Card","Calendar","e","port","year","month","index","AlertCircle","File","LoadingSpinner","Eye","Download"],"mappings":"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"}