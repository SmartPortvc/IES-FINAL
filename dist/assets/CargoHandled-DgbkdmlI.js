import{u as I,j as e,L as O,C as g,h as R,k as q}from"./index-DYPp-ivU.js";import{r as a}from"./vendor-BOKTEpvH.js";import{D as w}from"./DashboardLayout-CKQImzu3.js";import{D as z}from"./DateRangePicker-D0mmnk8J.js";import{E as Q}from"./ErrorDisplay-CLSu7BDk.js";import{a as v}from"./formatters-CaoZFZze.js";import{P as N,S as p,C as U,z as $}from"./ui-WwCSzw8y.js";const ee=()=>{const{userRole:_}=I(),[M,V]=a.useState([]),[D,A]=a.useState([]),[L,C]=a.useState(!0),[P,T]=a.useState(null),[h,B]=a.useState([]),[d,E]=a.useState(""),[x,F]=a.useState(""),[r,m]=a.useState(1),[y,H]=a.useState(10);a.useEffect(()=>{(async()=>{try{C(!0),T(null);const s=await R();V(s);const n=[];for(const o of s)if(o.id){const i=await q(o.id);n.push(...i.map(f=>({...f,portName:o.portName})))}A(n)}catch(s){console.error("Error fetching data:",s),T("Failed to load cargo data")}finally{C(!1)}})()},[]);const l=a.useMemo(()=>D.filter(t=>{const s=h.length===0||t.portId&&h.includes(t.portId);let n=!0;if(d&&t.arrivalDateTime){const o=new Date(t.arrivalDateTime.seconds*1e3),i=new Date(d);n=n&&o>=i}if(x&&t.arrivalDateTime){const o=new Date(t.arrivalDateTime.seconds*1e3),i=new Date(x);i.setHours(23,59,59,999),n=n&&o<=i}return s&&n}),[D,h,d,x]),c=Math.ceil(l.length/y),u=(r-1)*y,b=u+y,S=a.useMemo(()=>l.slice(u,b),[l,u,b]);a.useEffect(()=>{m(1)},[h,d,x]);const j=a.useMemo(()=>{const t={totalCargo:0,cargoByType:{},cargoByPort:{},averageCargoPerVessel:0};return l.forEach(s=>{var f,k;const n=((f=s.cargo)==null?void 0:f.quantity)||"0",o=parseInt(n.split(" ")[0])||0;t.totalCargo+=o;const i=((k=s.cargo)==null?void 0:k.type)||"Unknown";t.cargoByType[i]=(t.cargoByType[i]||0)+o,s.portName&&(t.cargoByPort[s.portName]=(t.cargoByPort[s.portName]||0)+o)}),t.averageCargoPerVessel=l.length>0?t.totalCargo/l.length:0,t},[l]);return L?e.jsx(w,{title:"Cargo Handled Details",children:e.jsx(O,{message:"Loading cargo data..."})}):P?e.jsx(w,{title:"Cargo Handled Details",children:e.jsx(Q,{message:P})}):e.jsxs(w,{title:"Cargo Handled Details",subtitle:"Analyze cargo data across all ports",icon:e.jsx($,{className:"h-6 w-6 text-seagreen-600"}),children:[e.jsx(g,{title:"Filters",icon:e.jsx(N,{className:"h-6 w-6 text-seagreen-600"}),className:"mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Ports for Comparison"}),e.jsx("select",{multiple:!0,value:h,onChange:t=>B(Array.from(t.target.selectedOptions,s=>s.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-seagreen-500",size:4,children:M.map(t=>e.jsx("option",{value:t.id,children:t.portName},t.id))}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Hold Ctrl/Cmd to select multiple ports"})]}),e.jsx(z,{fromDate:d,toDate:x,onFromDateChange:E,onToDateChange:F})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[e.jsxs(g,{title:"Total Cargo Handled",icon:e.jsx(N,{className:"h-5 w-5 text-seagreen-600"}),children:[e.jsxs("div",{className:"text-3xl font-bold text-gray-900",children:[j.totalCargo.toLocaleString()," MT"]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Across ",l.length," vessels"]})]}),e.jsxs(g,{title:"Average Cargo per Vessel",icon:e.jsx(p,{className:"h-5 w-5 text-seagreen-600"}),children:[e.jsxs("div",{className:"text-3xl font-bold text-gray-900",children:[Math.round(j.averageCargoPerVessel).toLocaleString()," MT"]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Based on selected data"})]}),e.jsx(g,{title:"Date Range",icon:e.jsx(U,{className:"h-5 w-5 text-seagreen-600"}),children:e.jsx("div",{className:"text-lg font-medium text-gray-900",children:d&&x?e.jsxs(e.Fragment,{children:[v(new Date(d))," - ",v(new Date(x))]}):"All Time"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(g,{title:"Cargo by Type",icon:e.jsx(N,{className:"h-6 w-6 text-seagreen-600"}),children:e.jsx("div",{className:"space-y-4",children:Object.entries(j.cargoByType).sort(([,t],[,s])=>s-t).map(([t,s])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(N,{className:"h-5 w-5 text-seagreen-500 mr-2"}),e.jsx("span",{className:"text-gray-700",children:t})]}),e.jsxs("span",{className:"font-medium text-gray-900",children:[s.toLocaleString()," MT"]})]},t))})}),e.jsx(g,{title:"Cargo by Port",icon:e.jsx(p,{className:"h-6 w-6 text-seagreen-600"}),children:e.jsx("div",{className:"space-y-4",children:Object.entries(j.cargoByPort).sort(([,t],[,s])=>s-t).map(([t,s])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(p,{className:"h-5 w-5 text-seagreen-500 mr-2"}),e.jsx("span",{className:"text-gray-700",children:t})]}),e.jsxs("span",{className:"font-medium text-gray-900",children:[s.toLocaleString()," MT"]})]},t))})})]}),e.jsx(g,{title:"Vessel Details",icon:e.jsx(p,{className:"h-6 w-6 text-seagreen-600"}),className:"mt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("label",{htmlFor:"itemsPerPage",className:"text-sm text-gray-700",children:"Items per page:"}),e.jsxs("select",{id:"itemsPerPage",value:y,onChange:t=>{H(Number(t.target.value)),m(1)},className:"px-3 py-1 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-seagreen-500 text-sm",children:[e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"}),e.jsx("option",{value:50,children:"50"}),e.jsx("option",{value:100,children:"100"})]})]}),e.jsxs("div",{className:"text-sm text-gray-700",children:["Showing ",l.length===0?0:u+1," to"," ",Math.min(b,l.length)," of ",l.length," vessels"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Vessel Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Port"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Arrival Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Cargo Type"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Quantity"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Operation"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:S.length>0?S.map(t=>{var s,n;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(p,{className:"h-5 w-5 text-seagreen-500 mr-2"}),e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.vesselName})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.portName}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.arrivalDateTime?v(t.arrivalDateTime):"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:((s=t.cargo)==null?void 0:s.type)||"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:((n=t.cargo)==null?void 0:n.quantity)||"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${t.operationType==="Loaded"?"bg-green-100 text-green-800":t.operationType==="Unloaded"?"bg-seagreen-100 text-seagreen-800":t.operationType==="Lighterage"?"bg-yellow-100 text-yellow-800":"bg-purple-100 text-purple-800"}`,children:t.operationType})})]},t.id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-8 text-center text-sm text-gray-500",children:"No vessels found matching the selected filters"})})})]})}),c>1&&e.jsxs("div",{className:"flex items-center justify-between border-t border-gray-200 pt-4",children:[e.jsx("button",{onClick:()=>m(t=>Math.max(t-1,1)),disabled:r===1,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Previous"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[r>3&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>m(1),className:"px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 transition-colors",children:"1"}),r>4&&e.jsx("span",{className:"px-2 text-gray-500",children:"..."})]}),Array.from({length:c},(t,s)=>s+1).filter(t=>t===r||t===r-1||t===r+1||t===r-2||t===r+2).map(t=>e.jsx("button",{onClick:()=>m(t),className:`px-3 py-2 text-sm font-medium rounded-md transition-colors ${r===t?"bg-seagreen-600 text-white":"text-gray-700 bg-white border border-gray-300 hover:bg-gray-50"}`,children:t},t)),r<c-2&&e.jsxs(e.Fragment,{children:[r<c-3&&e.jsx("span",{className:"px-2 text-gray-500",children:"..."}),e.jsx("button",{onClick:()=>m(c),className:"px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 transition-colors",children:c})]})]}),e.jsx("button",{onClick:()=>m(t=>Math.min(t+1,c)),disabled:r===c,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Next"})]})]})})]})};export{ee as default};
//# sourceMappingURL=CargoHandled-DgbkdmlI.js.map
