{"version":3,"file":"PortDashboard-YpATnnLu.js","sources":["../../src/hooks/usePortData.ts","../../src/hooks/useVessels.ts","../../src/pages/PortDashboard.tsx"],"sourcesContent":["import { useState, useEffect } from 'react';\nimport { useAuth } from '../context/AuthContext';\nimport { fetchUserPortId, fetchPortById } from '../services/api';\nimport { Port } from '../types';\n\nexport const usePortData = () => {\n  const { currentUser } = useAuth();\n  const [portData, setPortData] = useState<Port | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    const fetchPortData = async () => {\n      if (!currentUser) {\n        setLoading(false);\n        return;\n      }\n\n      try {\n        setLoading(true);\n        setError(null);\n        \n        // Get the port ID associated with the current user\n        const portId = await fetchUserPortId(currentUser.uid);\n        \n        if (!portId) {\n          setError('User is not associated with any port');\n          setLoading(false);\n          return;\n        }\n        \n        // Fetch the port data\n        const port = await fetchPortById(portId);\n        \n        if (!port) {\n          setError('Port data not found');\n          setLoading(false);\n          return;\n        }\n        \n        setPortData(port);\n      } catch (err) {\n        console.error('Error in usePortData hook:', err);\n        setError('Failed to load port information');\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    fetchPortData();\n  }, [currentUser]);\n\n  return { portData, loading, error };\n};","import { useState, useEffect } from 'react';\nimport { fetchVessels } from '../services/api';\nimport { Vessel } from '../types';\n\nexport const useVessels = (portId?: string) => {\n  const [vessels, setVessels] = useState<Vessel[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    const loadVessels = async () => {\n      try {\n        setLoading(true);\n        setError(null);\n        \n        // Only fetch vessels if portId is provided\n        if (portId) {\n          const vesselData = await fetchVessels(portId);\n          setVessels(vesselData);\n        } else {\n          // If no portId, set empty array\n          setVessels([]);\n        }\n      } catch (err) {\n        console.error('Error in useVessels hook:', err);\n        setError('Failed to load vessel data');\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    // Only run the fetch if we have a portId or explicitly set loading to false\n    if (portId) {\n      loadVessels();\n    } else {\n      setLoading(false);\n      setVessels([]);\n    }\n  }, [portId]);\n\n  return { vessels, loading, error, setVessels };\n};","import React, { useEffect, useState, useMemo } from 'react';\nimport { Ship, PlusCircle, FileText, Calendar } from 'lucide-react';\nimport { useNavigate } from 'react-router-dom';\nimport { useAuth } from '../context/AuthContext';\nimport { usePortData } from '../hooks/usePortData';\nimport { useVessels } from '../hooks/useVessels';\nimport DashboardLayout from '../components/layout/DashboardLayout';\nimport VesselList from '../components/vessel/VesselList';\nimport Card from '../components/ui/Card';\nimport Button from '../components/ui/Button';\nimport DateRangePicker from '../components/ui/DateRangePicker';\nimport LoadingSpinner from '../components/ui/LoadingSpinner';\nimport ErrorDisplay from '../components/ui/ErrorDisplay';\nimport ExcelReportGenerator from '../components/reports/ExcelReportGenerator';\nimport { generateExcelReport } from '../utils/excelReportGenerator';\n\nconst PortDashboard: React.FC = () => {\n  const navigate = useNavigate();\n  const { currentUser } = useAuth();\n  const { portData, loading: loadingPort, error: portError } = usePortData();\n  const [portId, setPortId] = useState<string | undefined>(undefined);\n  const [fromDate, setFromDate] = useState('');\n  const [toDate, setToDate] = useState('');\n  \n  // Set portId once portData is loaded\n  useEffect(() => {\n    if (portData && portData.id) {\n      setPortId(portData.id);\n    }\n  }, [portData]);\n  \n  // Fetch vessels for this port\n  const { vessels, loading: loadingVessels, error: vesselsError } = useVessels(portId);\n\n  // Filter vessels based on date range\n  const filteredVessels = useMemo(() => {\n    return vessels.filter(vessel => {\n      if (!fromDate && !toDate) return true;\n\n      const vesselDate = vessel.arrivalDateTime \n        ? new Date(vessel.arrivalDateTime.seconds * 1000) \n        : null;\n\n      if (!vesselDate) return true;\n\n      const fromDateObj = fromDate ? new Date(fromDate) : null;\n      const toDateObj = toDate ? new Date(toDate) : null;\n\n      if (fromDateObj && toDateObj) {\n        // Set end of day for toDate\n        toDateObj.setHours(23, 59, 59, 999);\n        return vesselDate >= fromDateObj && vesselDate <= toDateObj;\n      } else if (fromDateObj) {\n        return vesselDate >= fromDateObj;\n      } else if (toDateObj) {\n        toDateObj.setHours(23, 59, 59, 999);\n        return vesselDate <= toDateObj;\n      }\n\n      return true;\n    });\n  }, [vessels, fromDate, toDate]);\n\n  const handleAddVessel = () => {\n    navigate('/add-vessel');\n  };\n\n  const handleGenerateWeeklyReport = (selectedPortId: string) => {\n    const now = new Date();\n    const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);\n\n    const weeklyVessels = vessels.filter(vessel => {\n      const arrivalDate = vessel.arrivalDateTime;\n      if (!arrivalDate) return false;\n\n      let vesselDate: Date;\n      if (typeof arrivalDate === 'string') {\n        vesselDate = new Date(arrivalDate);\n      } else if (arrivalDate instanceof Date) {\n        vesselDate = arrivalDate;\n      } else if (arrivalDate.seconds) {\n        vesselDate = new Date(arrivalDate.seconds * 1000);\n      } else {\n        return false;\n      }\n\n      return vesselDate >= weekAgo && vesselDate <= now;\n    });\n\n    generateExcelReport(weeklyVessels, portData?.portName || 'Port', 'weekly', undefined, undefined, false);\n  };\n\n  const handleGenerateCustomReport = (fromDate: string, toDate: string, selectedPortId: string) => {\n    const from = new Date(fromDate);\n    from.setHours(0, 0, 0, 0);\n    const to = new Date(toDate);\n    to.setHours(23, 59, 59, 999);\n\n    const customVessels = vessels.filter(vessel => {\n      const arrivalDate = vessel.arrivalDateTime;\n      if (!arrivalDate) return false;\n\n      let vesselDate: Date;\n      if (typeof arrivalDate === 'string') {\n        vesselDate = new Date(arrivalDate);\n      } else if (arrivalDate instanceof Date) {\n        vesselDate = arrivalDate;\n      } else if (arrivalDate.seconds) {\n        vesselDate = new Date(arrivalDate.seconds * 1000);\n      } else {\n        return false;\n      }\n\n      return vesselDate >= from && vesselDate <= to;\n    });\n\n    generateExcelReport(customVessels, portData?.portName || 'Port', 'custom', fromDate, toDate, false);\n  };\n\n  if (loadingPort) {\n    return (\n      <DashboardLayout title=\"Port Dashboard\">\n        <LoadingSpinner message=\"Loading port data...\" />\n      </DashboardLayout>\n    );\n  }\n\n  if (portError) {\n    return (\n      <DashboardLayout title=\"Port Dashboard\">\n        <ErrorDisplay message={portError} />\n      </DashboardLayout>\n    );\n  }\n\n  return (\n    <DashboardLayout title=\"Port Dashboard\">\n      <div className=\"mb-6\">\n        <Card\n          title={`Welcome, ${portData?.portName}`}\n          icon={<Ship className=\"h-6 w-6 text-seagreen-600\" />}\n        >\n          <div className=\"flex flex-col md:flex-row md:items-center md:justify-between\">\n            <div>\n              <p className=\"text-gray-600 mb-4\">\n                Welcome to your port management dashboard. Here you can manage your vessels and view port information.\n              </p>\n              <div className=\"flex flex-wrap gap-4\">\n                <Button\n                  onClick={handleAddVessel}\n                  icon={<PlusCircle className=\"h-4 w-4\" />}\n                >\n                  Add New Vessel\n                </Button>\n                <Button\n                  variant=\"outline\"\n                  onClick={() => navigate('/port-profile')}\n                  icon={<FileText className=\"h-4 w-4\" />}\n                >\n                  View Port Profile\n                </Button>\n              </div>\n            </div>\n            <div className=\"mt-4 md:mt-0 bg-seagreen-50 p-4 rounded-lg\">\n              <h3 className=\"text-sm font-medium text-seagreen-800\">Quick Stats</h3>\n              <div className=\"mt-2 grid grid-cols-2 gap-4\">\n                <div>\n                  <p className=\"text-xs text-seagreen-600\">Total Vessels</p>\n                  <p className=\"text-2xl font-bold text-seagreen-900\">{filteredVessels.length}</p>\n                </div>\n                <div>\n                  <p className=\"text-xs text-seagreen-600\">Last Updated</p>\n                  <p className=\"text-sm font-medium text-seagreen-900\">\n                    {new Date().toLocaleDateString()}\n                  </p>\n                </div>\n              </div>\n            </div>\n          </div>\n        </Card>\n      </div>\n\n      <ExcelReportGenerator\n        onGenerateWeekly={handleGenerateWeeklyReport}\n        onGenerateCustom={handleGenerateCustomReport}\n        ports={portData ? [{ id: portData.id, portName: portData.portName }] : []}\n        selectedPortId={portData?.id}\n        isAdmin={false}\n      />\n\n      {/* Date Range Filter */}\n      <Card \n        title=\"Filter Vessels\" \n        icon={<Calendar className=\"h-6 w-6 text-seagreen-600\" />}\n        className=\"mb-6\"\n      >\n        <DateRangePicker\n          fromDate={fromDate}\n          toDate={toDate}\n          onFromDateChange={setFromDate}\n          onToDateChange={setToDate}\n          fromLabel=\"From Arrival Date\"\n          toLabel=\"To Arrival Date\"\n        />\n        {(fromDate || toDate) && (\n          <div className=\"mt-4 flex items-center justify-between bg-seagreen-50 p-3 rounded-lg\">\n            <p className=\"text-sm text-seagreen-700\">\n              Showing {filteredVessels.length} vessels\n              {fromDate && toDate ? ` from ${new Date(fromDate).toLocaleDateString()} to ${new Date(toDate).toLocaleDateString()}` : \n               fromDate ? ` from ${new Date(fromDate).toLocaleDateString()}` :\n               toDate ? ` until ${new Date(toDate).toLocaleDateString()}` : ''}\n            </p>\n            <Button\n              variant=\"outline\"\n              size=\"small\"\n              onClick={() => {\n                setFromDate('');\n                setToDate('');\n              }}\n            >\n              Clear Filters\n            </Button>\n          </div>\n        )}\n      </Card>\n\n      <VesselList \n        vessels={filteredVessels} \n        loading={loadingVessels} \n        error={vesselsError} \n      />\n    </DashboardLayout>\n  );\n};\n\nexport default PortDashboard;"],"names":["usePortData","currentUser","useAuth","portData","setPortData","useState","loading","setLoading","error","setError","useEffect","portId","fetchUserPortId","port","fetchPortById","err","useVessels","vessels","setVessels","vesselData","fetchVessels","PortDashboard","navigate","useNavigate","loadingPort","portError","setPortId","fromDate","setFromDate","toDate","setToDate","loadingVessels","vesselsError","filteredVessels","useMemo","vessel","vesselDate","fromDateObj","toDateObj","handleAddVessel","handleGenerateWeeklyReport","selectedPortId","now","weekAgo","weeklyVessels","arrivalDate","generateExcelReport","handleGenerateCustomReport","from","to","customVessels","jsx","DashboardLayout","LoadingSpinner","ErrorDisplay","jsxs","Card","Ship","Button","PlusCircle","FileText","ExcelReportGenerator","Calendar","DateRangePicker","VesselList"],"mappings":"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"}