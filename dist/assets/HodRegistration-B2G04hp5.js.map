{"version":3,"file":"HodRegistration-B2G04hp5.js","sources":["../../src/pages/HodRegistration.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { doc, getDoc, updateDoc } from 'firebase/firestore';\nimport { db } from '../firebase/config';\nimport { useAuth } from '../context/AuthContext';\nimport { toast } from 'react-toastify';\n\nconst HodRegistration: React.FC = () => {\n  const { hodId } = useParams<{ hodId: string }>();\n  const navigate = useNavigate();\n  const { registerHodUser } = useAuth();\n  \n  const [email, setEmail] = useState('');\n  const [name, setName] = useState('');\n  const [designation, setDesignation] = useState('');\n  const [department, setDepartment] = useState('');\n  const [password, setPassword] = useState('');\n  const [confirmPassword, setConfirmPassword] = useState('');\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState('');\n  const [hodExists, setHodExists] = useState(false);\n  const [invitationValid, setInvitationValid] = useState(true);\n\n  useEffect(() => {\n    const fetchHodData = async () => {\n      if (!hodId) return;\n      \n      try {\n        const hodDoc = await getDoc(doc(db, 'hods', hodId));\n        if (hodDoc.exists()) {\n          const hodData = hodDoc.data();\n          \n          // Check if HOD is already registered\n          if (hodData.status === 'registered') {\n            setError('This HOD has already been registered.');\n            setInvitationValid(false);\n            return;\n          }\n          \n          // Check if invitation is expired (7 days)\n          if (hodData.invitationSentAt) {\n            const invitationDate = new Date(hodData.invitationSentAt.toDate());\n            const now = new Date();\n            const diffTime = Math.abs(now.getTime() - invitationDate.getTime());\n            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));\n            \n            if (diffDays > 7) {\n              setError('This invitation has expired. Please contact the administrator for a new invitation.');\n              setInvitationValid(false);\n              return;\n            }\n          }\n          \n          setEmail(hodData.email || '');\n          setHodExists(true);\n        } else {\n          setError('Invalid registration link. HOD not found.');\n          setInvitationValid(false);\n        }\n      } catch (err) {\n        console.error('Error fetching HOD data:', err);\n        setError('Failed to load HOD information. Please try again later.');\n        setInvitationValid(false);\n      }\n    };\n\n    fetchHodData();\n  }, [hodId]);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    if (password !== confirmPassword) {\n      setError('Passwords do not match');\n      return;\n    }\n    \n    if (!hodId || !hodExists || !invitationValid) {\n      setError('Invalid or expired registration link');\n      return;\n    }\n    \n    setLoading(true);\n    setError('');\n    \n    try {\n      // Update HOD data in Firestore\n      await updateDoc(doc(db, 'hods', hodId), {\n        name,\n        designation,\n        department,\n        status: 'registered',\n        registeredAt: new Date()\n      });\n      \n      // Create user account\n      await registerHodUser(email, password, hodId, name, designation, department);\n      \n      toast.success('Registration completed successfully!');\n      \n      // Redirect to admin dashboard\n      navigate('/admin');\n    } catch (err) {\n      console.error('Error registering HOD:', err);\n      setError('Failed to complete registration. Please try again.');\n      toast.error('Registration failed. Please try again.');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  if (error && !invitationValid) {\n    return (\n      <div className=\"min-h-screen bg-gray-100 flex items-center justify-center p-4\">\n        <div className=\"bg-white rounded-lg shadow-xl w-full max-w-md p-8 text-center\">\n          <div className=\"text-red-600 mb-4\">\n            <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-16 w-16 mx-auto\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\n            </svg>\n          </div>\n          <h1 className=\"text-2xl font-bold text-gray-800 mb-2\">Registration Error</h1>\n          <p className=\"text-gray-600 mb-6\">{error}</p>\n          <button\n            onClick={() => navigate('/login')}\n            className=\"w-full bg-seagreen-600 hover:bg-seagreen-700 text-white font-medium py-2 px-4 rounded-md\"\n          >\n            Go to Login\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-100 py-12 px-4 sm:px-6 lg:px-8\">\n      <div className=\"max-w-3xl mx-auto\">\n        <div className=\"text-center mb-8\">\n          <img \n            src=\"https://apmaritime.in/assets/apmb-B0Lm-J0A.png\"\n            alt=\"APMB Logo\"\n            className=\"h-32 w-32 mx-auto mb-6 object-contain rounded-2xl shadow-lg\"\n          />\n          <h1 className=\"text-3xl font-bold text-gray-800\">Andhra Pradesh Maritime Board (APMB)</h1>\n          <p className=\"mt-2 text-xl font-medium text-seagreen-600\">HOD Registration</p>\n        </div>\n\n        {error && (\n          <div className=\"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-6\">\n            {error}\n          </div>\n        )}\n\n        <div className=\"bg-white rounded-lg shadow-md p-8\">\n          <form onSubmit={handleSubmit}>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n              <div>\n                <label htmlFor=\"email\" className=\"block text-gray-700 font-medium mb-2\">\n                  Email Address\n                </label>\n                <input\n                  type=\"email\"\n                  id=\"email\"\n                  value={email}\n                  disabled\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-md bg-gray-50\"\n                />\n              </div>\n\n              <div>\n                <label htmlFor=\"name\" className=\"block text-gray-700 font-medium mb-2\">\n                  Full Name\n                </label>\n                <input\n                  type=\"text\"\n                  id=\"name\"\n                  value={name}\n                  onChange={(e) => setName(e.target.value)}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-seagreen-500\"\n                  required\n                />\n              </div>\n\n              <div>\n                <label htmlFor=\"department\" className=\"block text-gray-700 font-medium mb-2\">\n                  Department\n                </label>\n                <input\n                  type=\"text\"\n                  id=\"department\"\n                  value={department}\n                  onChange={(e) => setDepartment(e.target.value)}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-seagreen-500\"\n                  required\n                />\n              </div>\n\n              <div>\n                <label htmlFor=\"designation\" className=\"block text-gray-700 font-medium mb-2\">\n                  Designation\n                </label>\n                <input\n                  type=\"text\"\n                  id=\"designation\"\n                  value={designation}\n                  onChange={(e) => setDesignation(e.target.value)}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-seagreen-500\"\n                  required\n                />\n              </div>\n            </div>\n\n            <div className=\"mt-8 border-t border-gray-200 pt-6\">\n              <h3 className=\"text-lg font-medium text-gray-800 mb-4\">Create Account</h3>\n              \n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                <div>\n                  <label htmlFor=\"password\" className=\"block text-gray-700 font-medium mb-2\">\n                    Password\n                  </label>\n                  <input\n                    type=\"password\"\n                    id=\"password\"\n                    value={password}\n                    onChange={(e) => setPassword(e.target.value)}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-seagreen-500\"\n                    required\n                    minLength={6}\n                  />\n                </div>\n\n                <div>\n                  <label htmlFor=\"confirmPassword\" className=\"block text-gray-700 font-medium mb-2\">\n                    Confirm Password\n                  </label>\n                  <input\n                    type=\"password\"\n                    id=\"confirmPassword\"\n                    value={confirmPassword}\n                    onChange={(e) => setConfirmPassword(e.target.value)}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-seagreen-500\"\n                    required\n                    minLength={6}\n                  />\n                </div>\n              </div>\n            </div>\n\n            <div className=\"mt-8\">\n              <button\n                type=\"submit\"\n                disabled={loading}\n                className=\"w-full bg-seagreen-600 hover:bg-seagreen-700 text-white font-medium py-3 px-4 rounded-md transition duration-300 ease-in-out disabled:opacity-50\"\n              >\n                {loading ? 'Registering...' : 'Complete Registration'}\n              </button>\n            </div>\n          </form>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default HodRegistration;"],"names":["HodRegistration","hodId","useParams","navigate","useNavigate","registerHodUser","useAuth","email","setEmail","useState","name","setName","designation","setDesignation","department","setDepartment","password","setPassword","confirmPassword","setConfirmPassword","loading","setLoading","error","setError","hodExists","setHodExists","invitationValid","setInvitationValid","useEffect","hodDoc","getDoc","doc","db","hodData","invitationDate","diffTime","err","handleSubmit","e","updateDoc","toast","jsxs","jsx"],"mappings":"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"}