import{u as V,m as F,n as A,k as R,j as e,L as G,C as S,B as P}from"./index-D2y675Iz.js";import{r as a,d as H}from"./vendor-Cjg16i2H.js";import{D as y}from"./DashboardLayout-D9MFwT0j.js";import{V as I}from"./VesselList-XP8QIrO5.js";import{D as $}from"./DateRangePicker-_xCTB5SA.js";import{E as U}from"./ErrorDisplay-DtSetXhG.js";import{E as W,g as b}from"./excelReportGenerator-BC_hGkN_.js";import{S as B,j as O,f as z,C as M}from"./ui-D_zlxExx.js";import"./SearchFilter-DIUQvNJl.js";import"./StatusBadge-BRHyn_fX.js";import"./formatters-CaoZFZze.js";import"./excelExport-CMCNPtFJ.js";const Q=()=>{const{currentUser:o}=V(),[s,d]=a.useState(null),[x,n]=a.useState(!0),[g,r]=a.useState(null);return a.useEffect(()=>{(async()=>{if(!o){n(!1);return}try{n(!0),r(null);const t=await F(o.uid);if(!t){r("User is not associated with any port"),n(!1);return}const D=await A(t);if(!D){r("Port data not found"),n(!1);return}d(D)}catch(t){console.error("Error in usePortData hook:",t),r("Failed to load port information")}finally{n(!1)}})()},[o]),{portData:s,loading:x,error:g}},q=o=>{const[s,d]=a.useState([]),[x,n]=a.useState(!0),[g,r]=a.useState(null);return a.useEffect(()=>{o?(async()=>{try{if(n(!0),r(null),o){const t=await R(o);d(t)}else d([])}catch(t){console.error("Error in useVessels hook:",t),r("Failed to load vessel data")}finally{n(!1)}})():(n(!1),d([]))},[o]),{vessels:s,loading:x,error:g,setVessels:d}},ne=()=>{const o=H();V();const{portData:s,loading:d,error:x}=Q(),[n,g]=a.useState(void 0),[r,j]=a.useState(""),[t,D]=a.useState("");a.useEffect(()=>{s&&s.id&&g(s.id)},[s]);const{vessels:v,loading:E,error:L}=q(n),N=a.useMemo(()=>v.filter(h=>{if(!r&&!t)return!0;const l=h.arrivalDateTime?new Date(h.arrivalDateTime.seconds*1e3):null;if(!l)return!0;const m=r?new Date(r):null,i=t?new Date(t):null;return m&&i?(i.setHours(23,59,59,999),l>=m&&l<=i):m?l>=m:i?(i.setHours(23,59,59,999),l<=i):!0}),[v,r,t]),k=()=>{o("/add-vessel")},C=h=>{const l=new Date,m=new Date(l.getTime()-7*24*60*60*1e3),i=v.filter(w=>{const c=w.arrivalDateTime;if(!c)return!1;let f;if(typeof c=="string")f=new Date(c);else if(c instanceof Date)f=c;else if(c.seconds)f=new Date(c.seconds*1e3);else return!1;return f>=m&&f<=l});b(i,(s==null?void 0:s.portName)||"Port","weekly",void 0,void 0,!1)},T=(h,l,m)=>{const i=new Date(h);i.setHours(0,0,0,0);const w=new Date(l);w.setHours(23,59,59,999);const c=v.filter(f=>{const u=f.arrivalDateTime;if(!u)return!1;let p;if(typeof u=="string")p=new Date(u);else if(u instanceof Date)p=u;else if(u.seconds)p=new Date(u.seconds*1e3);else return!1;return p>=i&&p<=w});b(c,(s==null?void 0:s.portName)||"Port","custom",h,l,!1)};return d?e.jsx(y,{title:"Port Dashboard",children:e.jsx(G,{message:"Loading port data..."})}):x?e.jsx(y,{title:"Port Dashboard",children:e.jsx(U,{message:x})}):e.jsxs(y,{title:"Port Dashboard",children:[e.jsx("div",{className:"mb-6",children:e.jsx(S,{title:`Welcome, ${s==null?void 0:s.portName}`,icon:e.jsx(B,{className:"h-6 w-6 text-seagreen-600"}),children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 mb-4",children:"Welcome to your port management dashboard. Here you can manage your vessels and view port information."}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsx(P,{onClick:k,icon:e.jsx(O,{className:"h-4 w-4"}),children:"Add New Vessel"}),e.jsx(P,{variant:"outline",onClick:()=>o("/port-profile"),icon:e.jsx(z,{className:"h-4 w-4"}),children:"View Port Profile"})]})]}),e.jsxs("div",{className:"mt-4 md:mt-0 bg-seagreen-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-sm font-medium text-seagreen-800",children:"Quick Stats"}),e.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-seagreen-600",children:"Total Vessels"}),e.jsx("p",{className:"text-2xl font-bold text-seagreen-900",children:N.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-seagreen-600",children:"Last Updated"}),e.jsx("p",{className:"text-sm font-medium text-seagreen-900",children:new Date().toLocaleDateString()})]})]})]})]})})}),e.jsx(W,{onGenerateWeekly:C,onGenerateCustom:T,ports:s?[{id:s.id,portName:s.portName}]:[],selectedPortId:s==null?void 0:s.id,isAdmin:!1}),e.jsxs(S,{title:"Filter Vessels",icon:e.jsx(M,{className:"h-6 w-6 text-seagreen-600"}),className:"mb-6",children:[e.jsx($,{fromDate:r,toDate:t,onFromDateChange:j,onToDateChange:D,fromLabel:"From Arrival Date",toLabel:"To Arrival Date"}),(r||t)&&e.jsxs("div",{className:"mt-4 flex items-center justify-between bg-seagreen-50 p-3 rounded-lg",children:[e.jsxs("p",{className:"text-sm text-seagreen-700",children:["Showing ",N.length," vessels",r&&t?` from ${new Date(r).toLocaleDateString()} to ${new Date(t).toLocaleDateString()}`:r?` from ${new Date(r).toLocaleDateString()}`:t?` until ${new Date(t).toLocaleDateString()}`:""]}),e.jsx(P,{variant:"outline",size:"small",onClick:()=>{j(""),D("")},children:"Clear Filters"})]})]}),e.jsx(I,{vessels:N,loading:E,error:L})]})};export{ne as default};
//# sourceMappingURL=PortDashboard-YpATnnLu.js.map
