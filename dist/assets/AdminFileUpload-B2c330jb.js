import{u as _,h as V,G as X,j as e,C as p,B as q,L as Q,H as W,I as Z,J as ee}from"./index-D2y675Iz.js";import{r as a}from"./vendor-Cjg16i2H.js";import{B as l,C as se,s as k,t as f,K as te,X as re,g as ae,H as le,O as ne,u as oe,A as ie}from"./ui-D_zlxExx.js";import{D as ce}from"./DashboardLayout-D9MFwT0j.js";const xe=()=>{const{currentUser:b}=_(),[P,U]=a.useState([]),[r,A]=a.useState(""),[n,B]=a.useState(new Date().getFullYear()),[o,I]=a.useState(new Date().getMonth()+1),[j,y]=a.useState([]),[Y,c]=a.useState(!1),[h,N]=a.useState(!1),[i,v]=a.useState(null),[w,F]=a.useState(""),[S,x]=a.useState(null),[D,d]=a.useState(""),m=a.useRef(null),C=["January","February","March","April","May","June","July","August","September","October","November","December"],z=Array.from({length:10},(s,t)=>new Date().getFullYear()-t);a.useEffect(()=>{L()},[]),a.useEffect(()=>{r&&n&&o?u():y([])},[r,n,o]);const L=async()=>{try{c(!0);const s=await V();U(s)}catch(s){console.error("Error loading ports:",s),l.error("Failed to load ports")}finally{c(!1)}},u=async()=>{if(r)try{c(!0);const s=await X(r,n,o);y(s)}catch(s){console.error("Error loading files:",s),l.error("Failed to load files")}finally{c(!1)}},J=s=>{var g;const t=(g=s.target.files)==null?void 0:g[0];if(t){if(t.size>10*1024*1024){l.error("File size must be less than 10MB");return}v(t)}},R=async()=>{if(!r){l.error("Please select a port");return}if(!i){l.error("Please select a file");return}if(!b){l.error("User not authenticated");return}try{N(!0),await W(r,n,o,i,w,b.uid),l.success("File uploaded successfully"),v(null),F(""),m.current&&(m.current.value=""),await u()}catch(s){console.error("Error uploading file:",s);const t=(s==null?void 0:s.message)||"Failed to upload file";l.error(t)}finally{N(!1)}},$=async s=>{if(r&&window.confirm(`Are you sure you want to delete "${s.originalFileName}"?`))try{await Z(r,n,o,s.id,s.url,s.storagePath),l.success("File deleted successfully"),await u()}catch(t){console.error("Error deleting file:",t),l.error("Failed to delete file")}},G=s=>{x(s.id),d(s.description||"")},H=()=>{x(null),d("")},K=async s=>{if(r)try{await ee(r,n,o,s,D),l.success("File description updated successfully"),x(null),d(""),await u()}catch(t){console.error("Error updating file description:",t),l.error("Failed to update file description")}},O=s=>{const t=document.createElement("a");t.href=s.url,t.download=s.originalFileName,document.body.appendChild(t),t.click(),document.body.removeChild(t)},M=s=>{if(s===0)return"0 Bytes";const t=1024,g=["Bytes","KB","MB","GB"],E=Math.floor(Math.log(s)/Math.log(t));return Math.round(s/Math.pow(t,E)*100)/100+" "+g[E]},T=s=>{if(!s)return"N/A";const t=s.toDate?s.toDate():new Date(s);return new Intl.DateTimeFormat("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(t)};return e.jsx(ce,{title:"Upload Files",subtitle:"Manage files by Port, Year, and Month",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(p,{title:"Select Port, Year & Month",icon:e.jsx(se,{className:"h-6 w-6 text-seagreen-600"}),children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Port"}),e.jsxs("select",{value:r,onChange:s=>A(s.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-seagreen-500 focus:border-seagreen-500",children:[e.jsx("option",{value:"",children:"Select Port"}),P.map(s=>e.jsx("option",{value:s.id,children:s.portName},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Year"}),e.jsx("select",{value:n,onChange:s=>B(Number(s.target.value)),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-seagreen-500 focus:border-seagreen-500",children:z.map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Month"}),e.jsx("select",{value:o,onChange:s=>I(Number(s.target.value)),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-seagreen-500 focus:border-seagreen-500",children:C.map((s,t)=>e.jsx("option",{value:t+1,children:s},t+1))})]})]})}),r&&e.jsx(p,{title:"Upload New File",icon:e.jsx(k,{className:"h-6 w-6 text-seagreen-600"}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"File Description"}),e.jsx("input",{type:"text",value:w,onChange:s=>F(s.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-seagreen-500 focus:border-seagreen-500",placeholder:"Enter file description (optional)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Select File"}),e.jsx("input",{ref:m,type:"file",onChange:J,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-seagreen-500 focus:border-seagreen-500"}),i&&e.jsxs("p",{className:"mt-2 text-sm text-gray-600",children:["Selected: ",i.name," (",M(i.size),")"]}),e.jsx("p",{className:"mt-2 text-xs text-gray-500",children:"Max file size: 10MB"})]}),e.jsx(q,{onClick:R,disabled:!i||h,loading:h,icon:e.jsx(k,{className:"h-4 w-4"}),children:h?"Uploading...":"Upload File"})]})}),r&&e.jsx(p,{title:`Uploaded Files - ${C[o-1]} ${n}`,icon:e.jsx(f,{className:"h-6 w-6 text-seagreen-600"}),children:Y?e.jsx(Q,{message:"Loading files..."}):j.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(f,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No files uploaded for this period"})]}):e.jsx("div",{className:"space-y-4",children:j.map(s=>e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(f,{className:"h-5 w-5 text-seagreen-600 flex-shrink-0"}),e.jsx("h4",{className:"font-semibold text-gray-900 truncate",children:s.originalFileName})]}),S===s.id?e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("input",{type:"text",value:D,onChange:t=>d(t.target.value),className:"flex-1 px-3 py-1.5 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-seagreen-500 focus:border-seagreen-500",placeholder:"Enter description"}),e.jsx("button",{onClick:()=>K(s.id),className:"p-1.5 text-seagreen-600 hover:bg-seagreen-50 rounded",title:"Save",children:e.jsx(te,{className:"h-4 w-4"})}),e.jsx("button",{onClick:H,className:"p-1.5 text-gray-600 hover:bg-gray-50 rounded",title:"Cancel",children:e.jsx(re,{className:"h-4 w-4"})})]}):e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:s.description||"No description"}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:[e.jsx("span",{children:M(s.fileSize)}),e.jsx("span",{children:"â€¢"}),e.jsxs("span",{children:["Uploaded ",T(s.uploadedAt)]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx("a",{href:s.url,target:"_blank",rel:"noopener noreferrer",className:"p-2 text-seagreen-600 hover:bg-seagreen-50 rounded-lg transition-colors",title:"View",children:e.jsx(ae,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>O(s),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Download",children:e.jsx(le,{className:"h-5 w-5"})}),S!==s.id&&e.jsx("button",{onClick:()=>G(s),className:"p-2 text-amber-600 hover:bg-amber-50 rounded-lg transition-colors",title:"Edit",children:e.jsx(ne,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>$(s),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Delete",children:e.jsx(oe,{className:"h-5 w-5"})})]})]})},s.id))})}),!r&&e.jsx("div",{className:"bg-seagreen-50 border border-seagreen-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx(ie,{className:"h-6 w-6 text-seagreen-600 mr-3 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-seagreen-800",children:"Select Port, Year & Month"}),e.jsx("p",{className:"mt-1 text-sm text-seagreen-700",children:"Please select a port, year, and month to upload and manage files."})]})]})})]})})};export{xe as default};
//# sourceMappingURL=AdminFileUpload-B2c330jb.js.map
