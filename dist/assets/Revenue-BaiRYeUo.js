import{u as _,j as e,L as q,C as A,k as y,h as J}from"./index-D2y675Iz.js";import{r as o}from"./vendor-Cjg16i2H.js";import{f as g,a as C}from"./formatters-CaoZFZze.js";import{D as w}from"./DashboardLayout-D9MFwT0j.js";import{E as K}from"./ErrorDisplay-DtSetXhG.js";import{S as Q}from"./SearchFilter-DIUQvNJl.js";import{D as X}from"./DateRangePicker-_xCTB5SA.js";import{S as L}from"./StatusBadge-BRHyn_fX.js";import{D as Z}from"./DataTable-CmL6mmj0.js";import{D as S,C as P,T as ee,S as k,e as te}from"./ui-D_zlxExx.js";const xe=()=>{const{userRole:p,currentUser:f}=_(),[V,M]=o.useState([]),[b,D]=o.useState([]),[F,T]=o.useState(!0),[j,R]=o.useState(null),[u,E]=o.useState("all"),[x,Y]=o.useState(""),[h,I]=o.useState(""),[m,O]=o.useState(""),[c,U]=o.useState("addedDate"),[ae,B]=o.useState(null);o.useEffect(()=>{(async()=>{try{if(T(!0),R(null),p==="port"&&f){const a=(await fetch(`/api/users/${f.uid}`).then(n=>n.json())).portId;B(a);const s=await y(a);D(s)}else{const r=await J();if(M(r),u&&u!=="all"){const a=await y(u);D(a)}else{const a=[];for(const s of r)if(s.id){const d=(await y(s.id)).map(l=>({...l,portName:s.portName}));a.push(...d)}D(a)}}}catch(r){console.error("Error fetching data:",r),R("Failed to load revenue data")}finally{T(!1)}})()},[p,f,u]);const i=o.useMemo(()=>b.filter(t=>{var n;const r=m===""||t.vesselName.toLowerCase().includes(m.toLowerCase())||t.imo.toLowerCase().includes(m.toLowerCase())||((n=t.cargo)==null?void 0:n.type)&&t.cargo.type.toLowerCase().includes(m.toLowerCase())||t.portName&&t.portName.toLowerCase().includes(m.toLowerCase());let a=!0;const s=c==="arrivalDate"?t.arrivalDateTime:t.addedDate||t.createdAt;if(x&&s){const d=new Date(s.seconds*1e3),l=new Date(x);a=a&&d>=l}if(h&&s){const d=new Date(s.seconds*1e3),l=new Date(h);l.setHours(23,59,59,999),a=a&&d<=l}return r&&a}),[b,m,x,h,c]),G=o.useMemo(()=>i.reduce((t,r)=>{if(!r.totalRevenue)return t;const s=String(r.totalRevenue).replace(/[^0-9.-]/g,""),n=parseFloat(s)||0;return t+n},0),[i]),$=o.useMemo(()=>{const t=new Date,r=new Date(t.getFullYear(),t.getMonth()-1,1),a=new Date(t.getFullYear(),t.getMonth(),0,23,59,59,999);return i.reduce((s,n)=>{const d=c==="arrivalDate"?n.arrivalDateTime:n.addedDate||n.createdAt;if(!d||!n.totalRevenue)return s;const l=new Date(d.seconds*1e3);if(l>=r&&l<=a){const v=String(n.totalRevenue).replace(/[^0-9.-]/g,""),N=parseFloat(v)||0;return s+N}return s},0)},[i,c]),z=o.useMemo(()=>{const t=new Date,r=new Date(t.getFullYear()-1,0,1),a=new Date(t.getFullYear()-1,11,31,23,59,59,999);return i.reduce((s,n)=>{const d=c==="arrivalDate"?n.arrivalDateTime:n.addedDate||n.createdAt;if(!d||!n.totalRevenue)return s;const l=new Date(d.seconds*1e3);if(l>=r&&l<=a){const v=String(n.totalRevenue).replace(/[^0-9.-]/g,""),N=parseFloat(v)||0;return s+N}return s},0)},[i,c]),H=[{key:"vesselName",header:"Vessel Name",render:(t,r)=>e.jsxs("div",{className:"flex items-center",children:[e.jsx(k,{className:"h-5 w-5 text-seagreen-500 mr-2"}),e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t})]})},{key:"portName",header:"Port Name",render:(t,r)=>e.jsxs("div",{className:"flex items-center",children:[e.jsx(te,{className:"h-5 w-5 text-teal-500 mr-2"}),e.jsx("div",{className:"text-sm text-gray-700",children:r.portName||"N/A"})]})},{key:"imo",header:"IMO"},{key:"arrivalDateTime",header:"Arrival Date",render:t=>t?C(t):"N/A"},{key:"addedDate",header:"Added Date",render:(t,r)=>{const a=t||r.createdAt;return a?C(a):"N/A"}},{key:"cargo",header:"Cargo Type",render:t=>(t==null?void 0:t.type)||"N/A"},{key:"operationType",header:"Operation",render:t=>e.jsx(L,{status:t,label:t})},{key:"voyageType",header:"Voyage Type",render:t=>e.jsx(L,{status:t,label:t})},{key:"totalRevenue",header:"Revenue",render:t=>e.jsx("span",{className:"text-sm font-medium text-gray-900",children:t?g(t):"N/A"})}];return F?e.jsx(w,{title:"Revenue Generated",children:e.jsx(q,{message:"Loading revenue data..."})}):j?e.jsx(w,{title:"Revenue Generated",children:e.jsx(K,{message:j})}):e.jsxs(w,{title:"Revenue Generated",subtitle:"Track and analyze revenue across all vessels",icon:e.jsx(S,{className:"h-6 w-6 text-seagreen-600"}),children:[e.jsxs(A,{title:"Revenue Filters",icon:e.jsx(P,{className:"h-6 w-6 text-seagreen-600"}),className:"mb-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[p!=="port"&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"portSelect",className:"block text-sm font-medium text-gray-700 mb-1",children:"Select Port"}),e.jsxs("select",{id:"portSelect",value:u,onChange:t=>E(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-seagreen-500",children:[e.jsx("option",{value:"all",children:"All Ports"}),V.map(t=>e.jsx("option",{value:t.id,children:t.portName},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"dateFilterType",className:"block text-sm font-medium text-gray-700 mb-1",children:"Filter By Date Type"}),e.jsxs("select",{id:"dateFilterType",value:c,onChange:t=>U(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-seagreen-500",children:[e.jsx("option",{value:"addedDate",children:"Vessel Added Date"}),e.jsx("option",{value:"arrivalDate",children:"Vessel Arrival Date"})]})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(X,{fromDate:x,toDate:h,onFromDateChange:Y,onToDateChange:I,fromLabel:`From ${c==="addedDate"?"Added":"Arrival"} Date`,toLabel:`To ${c==="addedDate"?"Added":"Arrival"} Date`})})]}),e.jsx("div",{className:"mt-6",children:e.jsx(Q,{searchTerm:m,setSearchTerm:O,searchPlaceholder:"Search vessels or ports...",showExport:!1})}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-seagreen-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(S,{className:"h-5 w-5 text-seagreen-600 mr-2"}),e.jsx("h3",{className:"text-sm font-medium text-seagreen-800",children:"Total Revenue"})]}),e.jsx("p",{className:"text-2xl font-bold text-seagreen-900",children:g(G)}),e.jsxs("p",{className:"text-xs text-seagreen-600 mt-1",children:["Based on ",i.length," vessels",x&&h&&e.jsxs(e.Fragment,{children:[" â€¢ Filtered by ",c==="addedDate"?"vessel added date":"vessel arrival date"]})]})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(P,{className:"h-5 w-5 text-green-600 mr-2"}),e.jsx("h3",{className:"text-sm font-medium text-green-800",children:"Last Month Revenue"})]}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:g($)}),e.jsx("p",{className:"text-xs text-green-600 mt-1",children:new Date().toLocaleString("default",{month:"long",year:"numeric"})})]}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(ee,{className:"h-5 w-5 text-purple-600 mr-2"}),e.jsx("h3",{className:"text-sm font-medium text-purple-800",children:"Last Year Revenue"})]}),e.jsx("p",{className:"text-2xl font-bold text-purple-900",children:g(z)}),e.jsx("p",{className:"text-xs text-purple-600 mt-1",children:new Date().getFullYear()-1})]})]})]}),e.jsx(A,{title:"Revenue Data",icon:e.jsx(S,{className:"h-6 w-6 text-seagreen-600"}),children:e.jsx(Z,{columns:H,data:i,loading:F,error:j,emptyMessage:"No revenue data found. Try adjusting your filters or add vessels with revenue information.",emptyIcon:e.jsx(k,{className:"h-12 w-12 mx-auto mb-3 text-gray-400"}),enablePagination:!0,itemsPerPage:10})})]})};export{xe as default};
//# sourceMappingURL=Revenue-BaiRYeUo.js.map
