{"version":3,"file":"HODFileView-oBTV9ZUw.js","sources":["../../src/pages/HODFileView.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { Download, Eye, File, Calendar, AlertCircle } from 'lucide-react';\r\nimport { toast } from 'react-toastify';\r\nimport DashboardLayout from '../components/layout/DashboardLayout';\r\nimport { fetchPorts, fetchFiles } from '../services/api';\r\nimport { Port, UploadedFile } from '../types';\r\nimport LoadingSpinner from '../components/ui/LoadingSpinner';\r\nimport Card from '../components/ui/Card';\r\n\r\nconst HODFileView: React.FC = () => {\r\n  const [ports, setPorts] = useState<Port[]>([]);\r\n  const [selectedPortId, setSelectedPortId] = useState<string>('');\r\n  const [selectedYear, setSelectedYear] = useState<number>(new Date().getFullYear());\r\n  const [selectedMonth, setSelectedMonth] = useState<number>(new Date().getMonth() + 1);\r\n  const [files, setFiles] = useState<UploadedFile[]>([]);\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  const months = [\r\n    'January', 'February', 'March', 'April', 'May', 'June',\r\n    'July', 'August', 'September', 'October', 'November', 'December'\r\n  ];\r\n\r\n  const years = Array.from({ length: 10 }, (_, i) => new Date().getFullYear() - i);\r\n\r\n  useEffect(() => {\r\n    loadPorts();\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (selectedPortId && selectedYear && selectedMonth) {\r\n      loadFiles();\r\n    } else {\r\n      setFiles([]);\r\n    }\r\n  }, [selectedPortId, selectedYear, selectedMonth]);\r\n\r\n  const loadPorts = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const portsData = await fetchPorts();\r\n      setPorts(portsData);\r\n    } catch (error) {\r\n      console.error('Error loading ports:', error);\r\n      toast.error('Failed to load ports');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const loadFiles = async () => {\r\n    if (!selectedPortId) return;\r\n    try {\r\n      setLoading(true);\r\n      const filesData = await fetchFiles(selectedPortId, selectedYear, selectedMonth);\r\n      setFiles(filesData);\r\n    } catch (error) {\r\n      console.error('Error loading files:', error);\r\n      toast.error('Failed to load files');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleDownload = (file: UploadedFile) => {\r\n    const link = document.createElement('a');\r\n    link.href = file.url;\r\n    link.download = file.originalFileName;\r\n    document.body.appendChild(link);\r\n    link.click();\r\n    document.body.removeChild(link);\r\n  };\r\n\r\n  const formatFileSize = (bytes: number): string => {\r\n    if (bytes === 0) return '0 Bytes';\r\n    const k = 1024;\r\n    const sizes = ['Bytes', 'KB', 'MB', 'GB'];\r\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\r\n    return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];\r\n  };\r\n\r\n  const formatDate = (timestamp: any) => {\r\n    if (!timestamp) return 'N/A';\r\n    const date = timestamp.toDate ? timestamp.toDate() : new Date(timestamp);\r\n    return new Intl.DateTimeFormat('en-US', {\r\n      year: 'numeric',\r\n      month: 'long',\r\n      day: 'numeric',\r\n      hour: '2-digit',\r\n      minute: '2-digit'\r\n    }).format(date);\r\n  };\r\n\r\n  return (\r\n    <DashboardLayout \r\n      title=\"View Files\" \r\n      subtitle=\"View and download files by Port, Year, and Month (Read-only access)\"\r\n    >\r\n      <div className=\"space-y-6\">\r\n        {/* Selection Section */}\r\n        <Card title=\"Select Port, Year & Month\" icon={<Calendar className=\"h-6 w-6 text-seagreen-600\" />}>\r\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n            <div>\r\n              <label className=\"block text-sm font-semibold text-gray-700 mb-2\">\r\n                Port\r\n              </label>\r\n              <select\r\n                value={selectedPortId}\r\n                onChange={(e) => setSelectedPortId(e.target.value)}\r\n                className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-seagreen-500 focus:border-seagreen-500\"\r\n              >\r\n                <option value=\"\">Select Port</option>\r\n                {ports.map((port) => (\r\n                  <option key={port.id} value={port.id}>\r\n                    {port.portName}\r\n                  </option>\r\n                ))}\r\n              </select>\r\n            </div>\r\n\r\n            <div>\r\n              <label className=\"block text-sm font-semibold text-gray-700 mb-2\">\r\n                Year\r\n              </label>\r\n              <select\r\n                value={selectedYear}\r\n                onChange={(e) => setSelectedYear(Number(e.target.value))}\r\n                className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-seagreen-500 focus:border-seagreen-500\"\r\n              >\r\n                {years.map((year) => (\r\n                  <option key={year} value={year}>\r\n                    {year}\r\n                  </option>\r\n                ))}\r\n              </select>\r\n            </div>\r\n\r\n            <div>\r\n              <label className=\"block text-sm font-semibold text-gray-700 mb-2\">\r\n                Month\r\n              </label>\r\n              <select\r\n                value={selectedMonth}\r\n                onChange={(e) => setSelectedMonth(Number(e.target.value))}\r\n                className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-seagreen-500 focus:border-seagreen-500\"\r\n              >\r\n                {months.map((month, index) => (\r\n                  <option key={index + 1} value={index + 1}>\r\n                    {month}\r\n                  </option>\r\n                ))}\r\n              </select>\r\n            </div>\r\n          </div>\r\n        </Card>\r\n\r\n        {/* Read-only Notice */}\r\n        <div className=\"bg-amber-50 border border-amber-200 rounded-lg p-4\">\r\n          <div className=\"flex\">\r\n            <AlertCircle className=\"h-6 w-6 text-amber-600 mr-3 flex-shrink-0\" />\r\n            <div>\r\n              <h3 className=\"font-medium text-amber-800\">Read-Only Access</h3>\r\n              <p className=\"mt-1 text-sm text-amber-700\">\r\n                You have view and download access only. You cannot upload, edit, or delete files.\r\n              </p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Files List */}\r\n        {selectedPortId && (\r\n          <Card \r\n            title={`Files - ${months[selectedMonth - 1]} ${selectedYear}`}\r\n            icon={<File className=\"h-6 w-6 text-seagreen-600\" />}\r\n          >\r\n            {loading ? (\r\n              <LoadingSpinner message=\"Loading files...\" />\r\n            ) : files.length === 0 ? (\r\n              <div className=\"text-center py-12\">\r\n                <File className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\r\n                <p className=\"text-gray-600\">No files available for this period</p>\r\n              </div>\r\n            ) : (\r\n              <div className=\"space-y-4\">\r\n                {files.map((file) => (\r\n                  <div\r\n                    key={file.id}\r\n                    className=\"bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow\"\r\n                  >\r\n                    <div className=\"flex items-start justify-between gap-4\">\r\n                      <div className=\"flex-1 min-w-0\">\r\n                        <div className=\"flex items-center gap-2 mb-2\">\r\n                          <File className=\"h-5 w-5 text-seagreen-600 flex-shrink-0\" />\r\n                          <h4 className=\"font-semibold text-gray-900 truncate\">\r\n                            {file.originalFileName}\r\n                          </h4>\r\n                        </div>\r\n                        \r\n                        {file.description && (\r\n                          <p className=\"text-sm text-gray-600 mb-2\">\r\n                            {file.description}\r\n                          </p>\r\n                        )}\r\n\r\n                        <div className=\"flex items-center gap-4 text-xs text-gray-500\">\r\n                          <span>{formatFileSize(file.fileSize)}</span>\r\n                          <span>â€¢</span>\r\n                          <span>Uploaded {formatDate(file.uploadedAt)}</span>\r\n                        </div>\r\n                      </div>\r\n\r\n                      <div className=\"flex items-center gap-2 flex-shrink-0\">\r\n                        <a\r\n                          href={file.url}\r\n                          target=\"_blank\"\r\n                          rel=\"noopener noreferrer\"\r\n                          className=\"p-2 text-seagreen-600 hover:bg-seagreen-50 rounded-lg transition-colors\"\r\n                          title=\"View\"\r\n                        >\r\n                          <Eye className=\"h-5 w-5\" />\r\n                        </a>\r\n                        <button\r\n                          onClick={() => handleDownload(file)}\r\n                          className=\"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors\"\r\n                          title=\"Download\"\r\n                        >\r\n                          <Download className=\"h-5 w-5\" />\r\n                        </button>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            )}\r\n          </Card>\r\n        )}\r\n\r\n        {!selectedPortId && (\r\n          <div className=\"bg-seagreen-50 border border-seagreen-200 rounded-lg p-4\">\r\n            <div className=\"flex\">\r\n              <AlertCircle className=\"h-6 w-6 text-seagreen-600 mr-3 flex-shrink-0\" />\r\n              <div>\r\n                <h3 className=\"font-medium text-seagreen-800\">Select Port, Year & Month</h3>\r\n                <p className=\"mt-1 text-sm text-seagreen-700\">\r\n                  Please select a port, year, and month to view files.\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </DashboardLayout>\r\n  );\r\n};\r\n\r\nexport default HODFileView;\r\n\r\n"],"names":["HODFileView","ports","setPorts","useState","selectedPortId","setSelectedPortId","selectedYear","setSelectedYear","selectedMonth","setSelectedMonth","files","setFiles","loading","setLoading","months","years","_","i","useEffect","loadPorts","loadFiles","portsData","fetchPorts","error","toast","filesData","fetchFiles","handleDownload","file","link","formatFileSize","bytes","k","sizes","formatDate","timestamp","date","jsx","DashboardLayout","jsxs","Card","Calendar","e","port","year","month","index","AlertCircle","File","LoadingSpinner","Eye","Download"],"mappings":"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"}