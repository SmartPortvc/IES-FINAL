import{j as e,F as S,B as b,u as se,L as re,C as I,m as ne,q as le,r as oe}from"./index-DYPp-ivU.js";import{r as i}from"./vendor-BOKTEpvH.js";import{D as A}from"./DashboardLayout-CKQImzu3.js";import{D as ie}from"./DateRangePicker-D0mmnk8J.js";import{E as ce}from"./ErrorDisplay-CLSu7BDk.js";import{e as de}from"./excelExport-Be0WQBzE.js";import{V as ue}from"./ViewReportModal-Dk7h4j2a.js";import{C as T,P as pe,S as R}from"./ui-WwCSzw8y.js";const xe=({report:c,isOpen:w,onClose:N,onSave:C})=>{var k;const[o,h]=i.useState(null);if(i.useEffect(()=>{c&&h({...c,departureDate:c.departureDate||"",clearanceIssued:c.clearanceIssued||"",dailyData:[...c.dailyData||[]],totalQuantity:c.totalQuantity||"",demurragesCollected:c.demurragesCollected||""})},[c]),!w||!o)return null;const p=(s,d,r)=>{const j=[...o.dailyData];j[s]={...j[s],[d]:r},h({...o,dailyData:j})},B=s=>{s.preventDefault(),C(o)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-5xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Edit Weekly Performance Report"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Update vessel performance information and daily cargo details"})]}),e.jsxs("button",{onClick:N,className:"text-gray-500 hover:text-gray-700 transition-colors",children:[e.jsx("span",{className:"sr-only",children:"Close"}),e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]})]}),e.jsxs("form",{onSubmit:B,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(S,{id:"departureDate",label:"Date of Departure",icon:e.jsx(T,{className:"h-5 w-5 text-seagreen-500"}),children:e.jsx("input",{type:"date",id:"departureDate",value:o.departureDate,onChange:s=>h({...o,departureDate:s.target.value}),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-seagreen-500"})}),e.jsx(S,{id:"clearanceIssued",label:"Clearance Issued",icon:e.jsx(T,{className:"h-5 w-5 text-seagreen-500"}),children:e.jsx("input",{type:"date",id:"clearanceIssued",value:o.clearanceIssued,onChange:s=>h({...o,clearanceIssued:s.target.value}),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-seagreen-500"})}),e.jsx(S,{id:"totalQuantity",label:"Total Quantity",icon:e.jsx(pe,{className:"h-5 w-5 text-seagreen-500"}),children:e.jsx("input",{type:"number",id:"totalQuantity",value:o.totalQuantity,onChange:s=>h({...o,totalQuantity:s.target.value}),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-seagreen-500"})})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Daily Cargo Details"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4  py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Date"}),e.jsx("th",{className:"px-4 w-40 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Type of Cargo in Detail"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Type of Cargo"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Quantity"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Demarage charges collected from the ship in Rs."}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Reason"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:(k=o.dailyData)==null?void 0:k.map((s,d)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"date",value:s.date,onChange:r=>p(d,"date",r.target.value),className:"w-full px-2 py-1 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-seagreen-500"})}),e.jsx("td",{className:"px-4 py-2",children:e.jsxs("select",{value:s.cargoType,onChange:r=>p(d,"cargoType",r.target.value),className:"w-full px-2 py-1 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-seagreen-500",children:[e.jsx("option",{value:"",children:"Select Cargo Type"}),e.jsx("option",{value:"Break Bulk",children:"Break Bulk"}),e.jsx("option",{value:"Project",children:"Project"}),e.jsx("option",{value:"Liquid Bulk",children:"Liquid Bulk"}),e.jsx("option",{value:"Container",children:"Container"}),e.jsx("option",{value:"Dry Bulk",children:"Dry Bulk"})]})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"text",value:s.typeOfCargo||"",onChange:r=>p(d,"typeOfCargo",r.target.value),className:"w-full px-2 py-1 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-seagreen-500",placeholder:"Enter cargo type"})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"number",value:s.totalQuantity||"",onChange:r=>p(d,"totalQuantity",r.target.value),className:"w-full px-2 py-1 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-seagreen-500",placeholder:"Enter quantity"})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"number",value:s.demurrages||"",onChange:r=>p(d,"demurrages",r.target.value),className:"w-full px-2 py-1 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-seagreen-500",placeholder:"Enter demurrages"})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"text",value:s.reason||"",onChange:r=>p(d,"reason",r.target.value),className:"w-full px-2 py-1 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-seagreen-500",placeholder:"Enter Reason"})})]},d))})]})})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t",children:[e.jsx(b,{variant:"outline",onClick:N,children:"Cancel"}),e.jsx(b,{type:"submit",className:"bg-seagreen-600 hover:bg-seagreen-700",children:"Save Changes"})]})]})]})})},De=()=>{const{currentUser:c}=se(),[w,N]=i.useState([]),[C,o]=i.useState(!0),[h,p]=i.useState(null),[B,k]=i.useState(null),[s,d]=i.useState(""),[r,j]=i.useState(""),[E,P]=i.useState(null),[O,W]=i.useState(!1),[Q,L]=i.useState(!1),M=t=>{P(t),W(!0)},F=t=>{P(t),L(!0)},V=async t=>{try{await oe(t.id,t);const l=w.map(u=>u.id===t.id?t:u);N(l),L(!1)}catch{p("Failed to update report")}};i.useEffect(()=>{(async()=>{try{o(!0),p(null);const l=await ne((c==null?void 0:c.uid)||"");if(!l){p("User port ID not found");return}k(l);const x=(await le()).filter(m=>m.portId===l);N(x),console.log("Fetched reports:",x)}catch{p("Failed to load weekly reports")}finally{o(!1)}})()},[c]);const n=i.useMemo(()=>w.filter(t=>{if(!s&&!r)return!0;const l=t.createdAt||t.created_at,u=l&&l.seconds?new Date(l.seconds*1e3):null;if(!u)return!0;const x=s?new Date(s):null,m=r?new Date(r):null;return x&&m?(m.setHours(23,59,59,999),u>=x&&u<=m):x?u>=x:m?(m.setHours(23,59,59,999),u<=m):!0}),[w,s,r]),U=i.useMemo(()=>{const t=new Date,l=new Date(t);l.setDate(t.getDate()-7),l.setHours(0,0,0,0);const u=new Date(t);u.setHours(23,59,59,999);const x=a=>{const g=a.createdAt||a.created_at;if(!g||!g.seconds)return!1;const f=new Date(g.seconds*1e3);return f>=l&&f<=u},m=n.filter(x).length,H=n.filter(a=>a.berthedDate).length,$=n.filter(a=>a.departureDate).length,_=H-$,z=n.filter(a=>a.status==="Loading").length,G=n.filter(a=>a.status==="Unloading").length,J=n.filter(a=>!!a.departureDate&&x(a)).length,K=n.reduce((a,g)=>{var y;const f=((y=g.dailyData)==null?void 0:y.reduce((D,v)=>D+(Number(v.demurrages)||0),0))||0;return a+f},0),X=n.reduce((a,g)=>{var y;const f=((y=g.dailyData)==null?void 0:y.reduce((D,v)=>D+(Number(v.totalQuantity)||0),0))||0;return a+f},0),Y=n.filter(a=>a.cargoType==="Bulk").length,Z=n.filter(a=>a.cargoType==="Break Bulk").length,ee=n.filter(a=>a.cargoType==="Container").length,te=n.filter(a=>a.cargoType==="Project").length,ae=n.filter(a=>a.cargoType==="Liquid").length;return[{description:"Total number of vessels called in the last week",total:m},{description:"Total number of vessels in the port as on date",total:_},{description:"Total number of vessels loading in the port as on date",total:z},{description:"Total number of vessels Unloading in the port as on date",total:G},{description:"Total vessels departed last week",total:J},{description:"Demurrages collected (if any) from the ships by the port",total:K},{description:"Total cargo handled since the start of the financial year",total:X},{description:"Cargo handled in the last week",total:n.filter(x).reduce((a,g)=>{var y;const f=((y=g.dailyData)==null?void 0:y.reduce((D,v)=>D+(Number(v.totalQuantity)||0),0))||0;return a+f},0)},{description:"Bulk cargo",total:Y},{description:"Break Bulk",total:Z},{description:"Container (in TEU & MMT)",total:ee},{description:"Project cargo",total:te},{description:"Liquid cargo",total:ae}]},[n]),q=()=>{const t=n.filter(l=>l.purposeOfArrival.toLowerCase()==="loading"||l.purposeOfArrival.toLowerCase()==="unloading");de(U,t)};return C?e.jsx(A,{title:"Weekly Reports",children:e.jsx(re,{message:"Loading weekly reports..."})}):h?e.jsx(A,{title:"Weekly Reports",children:e.jsx(ce,{message:h})}):e.jsxs(A,{title:"Weekly Reports",subtitle:"View and manage your port's weekly vessel performance reports",icon:e.jsx(R,{className:"h-6 w-6 text-seagreen-600"}),children:[e.jsxs(I,{title:"Filters",icon:e.jsx(T,{className:"h-6 w-6 text-seagreen-600"}),className:"mb-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsx("div",{className:"md:col-span-2",children:e.jsx(ie,{fromDate:s,toDate:r,onFromDateChange:d,onToDateChange:j,fromLabel:"From Report Date",toLabel:"To Report Date"})})}),(s||r)&&e.jsxs("div",{className:"mt-4 flex items-center justify-between bg-seagreen-50 p-3 rounded-lg",children:[e.jsxs("p",{className:"text-sm text-seagreen-700",children:["Showing ",n.length," reports",s&&r?` between ${new Date(s).toLocaleDateString()} and ${new Date(r).toLocaleDateString()}`:s?` from ${new Date(s).toLocaleDateString()}`:r?` until ${new Date(r).toLocaleDateString()}`:""]}),e.jsx("button",{onClick:()=>{d(""),j("")},className:"text-sm text-seagreen-600 hover:text-seagreen-800 font-medium",children:"Clear Filters"})]})]}),e.jsxs(I,{title:"Weekly Performance Reports",icon:e.jsx(R,{className:"h-6 w-6 text-seagreen-600"}),children:[e.jsx("div",{className:"w-full flex items-center mb-4",children:e.jsx(b,{variant:"outline",onClick:q,className:"ml-auto",icon:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e.jsx("polyline",{points:"7 10 12 15 17 10"}),e.jsx("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]}),children:"Export All"})}),n.length===0?e.jsxs("div",{className:"bg-gray-50 border border-gray-200 text-gray-700 px-4 py-8 rounded text-center",children:[e.jsx(R,{className:"h-12 w-12 mx-auto mb-3 text-gray-400"}),e.jsx("h3",{className:"text-lg font-medium",children:"No weekly reports found"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"No weekly performance reports have been added yet"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50 w-full",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Vessel Name"}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Agent Name"}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Owner Details"}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Purpose"}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"DWT"}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"LOA"}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Berthed Date"}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Departure Date"}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Clearance Status"}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:n.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.vesselName||"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.agentName||"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.ownerDetails||"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.purposeOfArrival||"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.status||"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.dwt||"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.loa||"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.berthedDate||"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.departureDate||"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.clearanceIssued||"N/A"}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap space-x-2",children:[e.jsx(b,{variant:"outline",onClick:()=>M(t),className:"mr-2",children:"View"}),e.jsx(b,{variant:"outline",onClick:()=>F(t),children:"Edit"})]})]},t.id))})]})})]}),e.jsx(ue,{report:E,isOpen:O,onClose:()=>W(!1)}),e.jsx(xe,{report:E,isOpen:Q,onClose:()=>L(!1),onSave:V})]})};export{De as default};
//# sourceMappingURL=WeeklyPerformance-DUjhSSnc.js.map
