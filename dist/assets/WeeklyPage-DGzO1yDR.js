import{j as e,L as Y,C as P,B as R,h as Z,q as ee}from"./index-DYPp-ivU.js";import{r as n}from"./vendor-BOKTEpvH.js";import{D as u}from"./DashboardLayout-CKQImzu3.js";import{D as te}from"./DateRangePicker-D0mmnk8J.js";import{E as ae}from"./ErrorDisplay-CLSu7BDk.js";import{e as se}from"./excelExport-Be0WQBzE.js";import{V as re}from"./ViewReportModal-Dk7h4j2a.js";import{C as le,S as h}from"./ui-WwCSzw8y.js";const ue=()=>{var v;const[W,O]=n.useState(null),[I,g]=n.useState(!1),[f,V]=n.useState([]),[y,E]=n.useState([]),[M,w]=n.useState(!0),[N,j]=n.useState(null),[p,k]=n.useState("all"),[i,D]=n.useState(""),[c,b]=n.useState("");n.useEffect(()=>{(async()=>{try{w(!0),j(null);const s=await Z();V(s);const l=await ee();E(l),console.log({allReports:l})}catch{j("Failed to load weekly reports")}finally{w(!1)}})()},[]);const r=n.useMemo(()=>y.filter(t=>{if(p!=="all"&&t.portId!==p)return!1;if(!i&&!c)return!0;const s=t.createdAt||t.created_at,l=s&&s.seconds?new Date(s.seconds*1e3):null;if(!l)return!0;const d=i?new Date(i):null,o=c?new Date(c):null;return d&&o?(o.setHours(23,59,59,999),l>=d&&l<=o):d?l>=d:o?(o.setHours(23,59,59,999),l<=o):!0}),[y,p,i,c]);function F(t){const s={Container:0,"Break Bulk":0,Project:0,"Liquid Bulk":0,"Dry Bulk":0};for(const l of t)if(l.clearanceIssued)for(const d of l.dailyData){const o=d.cargoType,m=parseFloat(d.totalQuantity);!isNaN(m)&&s.hasOwnProperty(o)&&(s[o]+=m)}return s}const q=n.useMemo(()=>{const t=new Date,s=new Date(t);s.setDate(t.getDate()-7),s.setHours(0,0,0,0);const l=new Date(t);l.setHours(23,59,59,999);const d=a=>{const x=a.createdAt||a.created_at;if(!x||!x.seconds)return!1;const T=new Date(x.seconds*1e3);return T>=s&&T<=l},o=r.filter(d).length,m=r.filter(a=>a.berthedDate).length,$=r.filter(a=>a.departureDate).length,Q=m-$,U=r.filter(a=>a.purposeOfArrival.toLowerCase()==="loading"&&!!a.clearanceIssued).length,_=r.filter(a=>a.purposeOfArrival.toLowerCase()==="unloading"&&!!a.clearanceIssued).length,z=r.filter(a=>!!a.departureDate&&d(a)).length,G=r.reduce((a,x)=>a+(Number(x.demurragesCollected)||0),0),J=r.reduce((a,x)=>a+(Number(x.totalQuantity)||0),0),{Container:C,"Break Bulk":A,Project:S,"Liquid Bulk":L,"Dry Bulk":B}=F(r),K=r.filter(a=>!!a.clearanceIssued).length,X=r.filter(a=>!!a.clearanceIssued).length;return[{description:"Total number of vessels called in the last week",total:o},{description:"Total number of vessels in the port as on date",total:Q},{description:"Total number of vessels loading in the port as on date",total:U},{description:"Total number of vessels Unloading in the port as on date",total:_},{description:"Total vessels departed last week",total:z},{description:"Demurrages collected (if any) from the ships by the port",total:G},{description:"Total cargo handled since the start of the financial year",total:J},{description:"Cargo handled in the last week",total:A+B+C+S+L},{description:"Bulk cargo",total:B},{description:"Break Bulk",total:A},{description:"Container (in TEU & MMT)",total:C},{description:"Project cargo",total:S},{description:"Liquid cargo",total:L},{description:"Total number of vessels applied for clearance",total:K},{description:"Total number of clearances issued",total:X}]},[r]),H=()=>{const t=r.filter(s=>s.purposeOfArrival.toLowerCase()==="loading"||s.purposeOfArrival.toLowerCase()==="unloading");se(q,t)};return M?e.jsx(u,{title:"Weekly Reports",children:e.jsx(Y,{message:"Loading weekly reports..."})}):N?e.jsx(u,{title:"Weekly Reports",children:e.jsx(ae,{message:N})}):e.jsxs(u,{title:"Weekly Reports",subtitle:"View and manage all weekly vessel performance reports",icon:e.jsx(h,{className:"h-6 w-6 text-seagreen-600"}),children:[e.jsxs(P,{title:"Filters",icon:e.jsx(le,{className:"h-6 w-6 text-seagreen-600"}),className:"mb-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Select Port"}),e.jsxs("select",{value:p,onChange:t=>k(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-seagreen-500",children:[e.jsx("option",{value:"all",children:"All Ports"}),f.map(t=>e.jsx("option",{value:t.id,children:t.portName},t.id))]})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(te,{fromDate:i,toDate:c,onFromDateChange:D,onToDateChange:b,fromLabel:"From Report Date",toLabel:"To Report Date"})})]}),(i||c||p!=="all")&&e.jsxs("div",{className:"mt-4 flex items-center justify-between bg-seagreen-50 p-3 rounded-lg",children:[e.jsxs("p",{className:"text-sm text-seagreen-700",children:["Showing ",r.length," reports",p!=="all"&&` from ${(v=f.find(t=>t.id===p))==null?void 0:v.portName}`,i&&c?` between ${new Date(i).toLocaleDateString()} and ${new Date(c).toLocaleDateString()}`:i?` from ${new Date(i).toLocaleDateString()}`:c?` until ${new Date(c).toLocaleDateString()}`:""]}),e.jsx("button",{onClick:()=>{D(""),b(""),k("all")},className:"text-sm text-seagreen-600 hover:text-seagreen-800 font-medium",children:"Clear Filters"})]})]}),e.jsxs(P,{title:"Weekly Performance Reports",icon:e.jsx(h,{className:"h-6 w-6 text-seagreen-600"}),children:[e.jsx("div",{className:"w-full flex items-center mb-4",children:e.jsx(R,{variant:"outline",onClick:H,className:"ml-auto",icon:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e.jsx("polyline",{points:"7 10 12 15 17 10"}),e.jsx("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]}),children:"Export All"})}),r.length===0?e.jsxs("div",{className:"bg-gray-50 border border-gray-200 text-gray-700 px-4 py-8 rounded text-center",children:[e.jsx(h,{className:"h-12 w-12 mx-auto mb-3 text-gray-400"}),e.jsx("h3",{className:"text-lg font-medium",children:"No weekly reports found"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"No weekly performance reports have been added yet"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50 w-full",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Vessel Name"}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Port"}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Agent Name"}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Owner Details"}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Purpose"}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Cargo Type"}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type of Cargo"}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total Quantity"}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"DWT"}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"LOA"}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Berthed Date"}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Departure Date"}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Demurrages"}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Clearance Status"}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:r.map(t=>{var s;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.vesselName||"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:((s=t.port)==null?void 0:s.portName)||"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.agentName||"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.ownerDetails||"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.purposeOfArrival||"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.status||"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.cargoType||"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.typeOfCargo||"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.totalQuantity??"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.dwt||"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.loa||"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.berthedDate||"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.departureDate||"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.demurragesCollected??"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.clearanceIssued||"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx(R,{variant:"outline",onClick:()=>{O(t),g(!0)},children:"View Details"})})]},t.id)})})]})})]}),e.jsx(re,{report:W,isOpen:I,onClose:()=>g(!1)})]})};export{ue as default};
//# sourceMappingURL=WeeklyPage-DGzO1yDR.js.map
