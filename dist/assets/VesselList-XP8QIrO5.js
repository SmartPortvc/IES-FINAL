import{j as e,L as oe,C as ne,B as ie}from"./index-D2y675Iz.js";import{r as x,d as le}from"./vendor-Cjg16i2H.js";import{E as ce}from"./ErrorDisplay-DtSetXhG.js";import{S as de}from"./SearchFilter-DIUQvNJl.js";import{S as U}from"./StatusBadge-BRHyn_fX.js";import{f as q,b as z}from"./formatters-CaoZFZze.js";import{a as me}from"./excelExport-CMCNPtFJ.js";import{S as V,C as ue,N as xe,P as ge,D as pe,E as fe}from"./ui-D_zlxExx.js";const he=({vessels:T,loading:H,error:I,portName:C,showExport:E=!1})=>{const F=le(),[k,Q]=x.useState(""),[D,_]=x.useState("all"),[v,ye]=x.useState(""),[A,be]=x.useState(""),[m,$]=x.useState(1),[b,G]=x.useState(10),J=x.useCallback(t=>{F(`/vessel-details/${t}`)},[F]),y=x.useMemo(()=>T.filter(t=>{var n,d,r,s,g,w;const a=k.toLowerCase(),o=(((n=t.vesselName)==null?void 0:n.toLowerCase().includes(a))??!1)||(((d=t.imo)==null?void 0:d.toLowerCase().includes(a))??!1)||(((r=t.arrivalFrom)==null?void 0:r.toLowerCase().includes(a))??!1)||(((g=(s=t.cargo)==null?void 0:s.type)==null?void 0:g.toLowerCase().includes(a))??!1)||(((w=t.portName)==null?void 0:w.toLowerCase().includes(a))??!1),i=D==="all"||t.operationType===D;let c=!0;if(v||A){const u=t.arrivalDateTime;if(u){let f;if(typeof u=="string")f=new Date(u);else if(u instanceof Date)f=u;else if(u&&typeof u=="object"&&"seconds"in u)f=new Date(u.seconds*1e3);else return c=!1,!1;if(v){const h=new Date(v);h.setHours(0,0,0,0),f<h&&(c=!1)}if(A&&c){const h=new Date(A);h.setHours(23,59,59,999),f>h&&(c=!1)}}else c=!1}return o&&i&&c}),[T,k,D,v,A]),j=Math.ceil(y.length/b),K=x.useMemo(()=>{const t=(m-1)*b,a=t+b;return y.slice(t,a)},[y,m,b]),S=t=>{$(t),window.scrollTo({top:0,behavior:"smooth"})},X=t=>{G(t),$(1)};x.useEffect(()=>{$(1)},[k,D,v,A]),console.log({vessels:T.filter(t=>t.imo==="12341234")});function Y(t){const a={Container:0,"Break Bulk":0,Project:0,"Liquid Bulk":0,"Dry Bulk":0};for(const o of t)if(o.clearanceIssuedOn)for(const i of o.dailyCargoDetails||[]){const c=i.cargoTypeInDetail,n=parseFloat(i.quantity||"0");!isNaN(n)&&c&&c in a&&(a[c]+=n)}return a}function Z(t){return t.map(a=>{var i;const o=((i=a.dailyCargoDetails)==null?void 0:i.reduce((c,n)=>{const d=parseFloat(n.demurrageCharges||"0")||0;return c+d},0))||0;return{vesselName:a.vesselName,totalDemurrage:o}})}function ee(t){return t.map(a=>{var i;const o=((i=a.dailyCargoDetails)==null?void 0:i.reduce((c,n)=>{const d=parseFloat(n.quantity||"0")||0;return c+d},0))||0;return{vesselName:a.vesselName,totalQuantity:o}})}const R=(t,a)=>{const o=new Date,i=new Date(o);i.setDate(o.getDate()-7),i.setHours(0,0,0,0);const c=new Date(o);c.setHours(23,59,59,999);const n=l=>{const N=l.createdAt||l.addedDate;if(!N||!N.seconds)return!1;const W=new Date(N.seconds*1e3);return W>=i&&W<=c},d=t.filter(n).length,r=t.filter(l=>l.berthingDateTime).length,s=t.filter(l=>l.pobDepartureDateTime).length,g=r-s,w=t.filter(l=>l.operationType.toLowerCase()==="loading"&&!!l.clearanceIssuedOn).length,u=t.filter(l=>l.operationType.toLowerCase()==="unloading"&&!!l.clearanceIssuedOn).length,f=t.filter(l=>!!l.pobDepartureDateTime&&n(l)).length,h=Z(t).reduce((l,{totalDemurrage:N})=>l+N,0),O=ee(t).reduce((l,{totalQuantity:N})=>l+N,0),{Container:L,"Break Bulk":P,Project:B,"Liquid Bulk":p,"Dry Bulk":M}=Y(t),re=t.filter(l=>!!l.clearanceIssuedOn).length,se=t.filter(l=>!!l.clearanceIssuedOn).length;return[{description:`Total number of vessels called in ${a} in the last week`,total:d},{description:`Total number of vessels in ${a} as on date`,total:g},{description:`Total number of vessels loading in ${a} as on date`,total:w},{description:`Total number of vessels unloading in ${a} as on date`,total:u},{description:`Total vessels departed from ${a} last week`,total:f},{description:`Demurrages collected from ships by ${a}`,total:h},{description:`Total cargo handled by ${a} since start of financial year`,total:O},{description:`Cargo handled by ${a} in the last week`,total:P+M+L+B+p},{description:`${a} - Bulk cargo`,total:M},{description:`${a} - Break Bulk`,total:P},{description:`${a} - Container (in TEU & MMT)`,total:L},{description:`${a} - Project cargo`,total:B},{description:`${a} - Liquid cargo`,total:p},{description:`Total number of vessels applied for clearance at ${a}`,total:re},{description:`Total number of clearances issued by ${a}`,total:se}]},te=()=>{const t=y,a=new Map;t.forEach(n=>{const d=n.portName||"Unknown Port";a.has(d)||a.set(d,[]),a.get(d).push(n)});const o=R(t,"All Ports"),i=[];i.push({portName:"All Ports",summary:o,vessels:t.filter(n=>n.clearanceIssuedOn)}),Array.from(a.entries()).sort(([n],[d])=>n.localeCompare(d)).forEach(([n,d])=>{const r=R(d,n);i.push({portName:n,summary:r,vessels:d.filter(s=>s.clearanceIssuedOn)})}),console.log({portSummaries:i}),me(i)},ae=x.useCallback(()=>{const t=["Vessel Name","IMO Number","GRT","Port Name","Vessel Owner","Vessel Agent","Entry Date","Sailed Out Date","Arrival Date & Time","Pilot On Board Date & Time","Berthing Date & Time","Pilot Off Board Date & Time","Next Port of Call","Length Over All (LOA)","Beam","Dead Weight Tonnage (DWT)","Length","Draft Available","Arrival Draft Forward","Arrival Draft Aft","Departure Draft Forward","Departure Draft Aft","Operation Type","Voyage Type","Operation","Arrival From","Location","Cargo Type","Cargo Name","Cargo Volume","Volume Units","Cargo Quantity","Total Revenue","Status"].join(","),a=T.map(r=>{var w,u,f,h,O,L,P,B;const s=p=>p==null?"":typeof p=="string"?`"${p.replace(/"/g,'""')}"`:p,g=p=>p?z(p):"";return[s(r.vesselName),s(r.imo),s(r.grt),s(r.portName),s(r.vesselOwner),s(r.vesselAgent),s(g(r.entryDate)),s(g(r.sailedOutDate)),s(g(r.arrivalDateTime)),s(g(r.pobDateTime)),s(g(r.berthingDateTime)),s(g(r.pobDepartureDateTime)),s(r.nextPortOfCall),s(r.loa),s(r.beam),s(r.dwt),s(r.length),s(r.draftAvailable),s((w=r.arrivalDraft)==null?void 0:w.forward),s((u=r.arrivalDraft)==null?void 0:u.aft),s((f=r.departureDraft)==null?void 0:f.forward),s((h=r.departureDraft)==null?void 0:h.aft),s(r.operationType),s(r.voyageType),s(r.operation),s(r.arrivalFrom),s(r.location),s((O=r.cargo)==null?void 0:O.type),s((L=r.cargo)==null?void 0:L.name),s((P=r.cargo)==null?void 0:P.volume),s((B=r.cargo)==null?void 0:B.units),s(r.cargoQuantity),s(r.totalRevenue?q(r.totalRevenue):""),s(r.sailedOutDate?"Sailed":"Active")].join(",")}),o=[t,...a].join(`
`),i=new Blob([o],{type:"text/csv;charset=utf-8;"}),c=URL.createObjectURL(i),n=document.createElement("a"),d=new Date().toISOString().split("T")[0];n.setAttribute("href",c),n.setAttribute("download",`${C?`${C}_`:""}vessels_${d}.csv`),document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(c)},[T,C]);return H?e.jsx(oe,{message:"Loading vessels..."}):I?e.jsx(ce,{message:I}):e.jsxs(ne,{title:C?`Vessels - ${C}`:"Vessel List",icon:e.jsx(V,{className:"h-6 w-6 text-seagreen-600"}),children:[e.jsx(de,{searchTerm:k,setSearchTerm:Q,searchPlaceholder:"Search by vessel name, IMO, cargo type...",filterOptions:[{value:"all",label:"All Types"},{value:"Import",label:"Import"},{value:"Export",label:"Export"},{value:"Coastal",label:"Coastal"}],filterValue:D,setFilterValue:t=>_(t),onExport:E?ae:void 0,showExport:E,handleExportAllWeekly:te}),y.length===0?e.jsxs("div",{className:"bg-gray-50 border border-gray-200 text-gray-700 px-4 py-8 rounded text-center",children:[e.jsx(V,{className:"h-12 w-12 mx-auto mb-3 text-gray-400"}),e.jsx("h3",{className:"text-lg font-medium",children:"No vessels found"}),e.jsx("p",{className:"mt-2 text-gray-500",children:k||D!=="all"?"Try adjusting your search or filter criteria":"No vessels have been added yet"})]}):e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Vessel Details"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Arrival Info"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Operation"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Cargo Details"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Revenue"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:K.map(t=>{var a,o,i;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(V,{className:"h-5 w-5 text-seagreen-500 mr-2"}),e.jsx("span",{className:"font-medium text-gray-900",children:t.vesselName||"N/A"})]}),e.jsxs("div",{className:"mt-1 text-sm text-gray-500",children:[e.jsxs("div",{children:["IMO: ",t.imo||"N/A"]}),e.jsxs("div",{children:["GRT: ",t.grt||"N/A"]})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-900",children:[e.jsx(ue,{className:"h-4 w-4 text-gray-400 mr-2"}),t.arrivalDateTime?z(t.arrivalDateTime):"N/A"]}),e.jsxs("div",{className:"mt-1 flex items-center text-sm text-gray-500",children:[e.jsx(xe,{className:"h-4 w-4 text-gray-400 mr-2"}),"From: ",t.arrivalFrom||"N/A"]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsx(U,{status:t.operationType,label:t.operationType||"N/A"}),e.jsx(U,{status:t.voyageType,label:t.voyageType||"N/A"})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(ge,{className:"h-5 w-5 text-gray-400 mt-0.5"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:((a=t.cargo)==null?void 0:a.type)||"N/A"}),e.jsx("div",{className:"text-sm text-gray-500",children:((o=t.cargo)==null?void 0:o.name)||"N/A"}),e.jsx("div",{className:"text-sm text-gray-500",children:(i=t.cargo)!=null&&i.volume?`${t.cargo.volume} ${t.cargo.units}`:"N/A"})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(pe,{className:"h-5 w-5 text-gray-400 mr-1"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:t.totalRevenue?q(t.totalRevenue):"N/A"})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsx(ie,{variant:"outline",size:"small",onClick:()=>J(t.id),icon:e.jsx(fe,{className:"h-4 w-4"}),children:"View Details"})})]},t.id)})})]}),y.length>0&&e.jsx("div",{className:"mt-4 flex items-center justify-between border-t border-gray-200 bg-white px-4 py-3 sm:px-6",children:e.jsxs("div",{className:"flex flex-1 items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Showing"," ",e.jsx("span",{className:"font-medium",children:(m-1)*b+1})," ","-"," ",e.jsx("span",{className:"font-medium",children:Math.min(m*b,y.length)})," ","of"," ",e.jsx("span",{className:"font-medium",children:y.length})," ","results"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{htmlFor:"pageSize",className:"text-sm text-gray-700",children:"Per page:"}),e.jsxs("select",{id:"pageSize",value:b,onChange:t=>X(Number(t.target.value)),className:"rounded-md border-gray-300 py-1 pl-3 pr-8 text-sm focus:border-seagreen-500 focus:outline-none focus:ring-1 focus:ring-seagreen-500",children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"}),e.jsx("option",{value:50,children:"50"}),e.jsx("option",{value:100,children:"100"})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>S(1),disabled:m===1,className:"relative inline-flex items-center rounded-md border border-gray-300 bg-white px-3 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"First"}),e.jsx("button",{onClick:()=>S(m-1),disabled:m===1,className:"relative inline-flex items-center rounded-md border border-gray-300 bg-white px-3 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(5,j)},(t,a)=>{let o;return j<=5||m<=3?o=a+1:m>=j-2?o=j-4+a:o=m-2+a,e.jsx("button",{onClick:()=>S(o),className:`relative inline-flex items-center rounded-md border px-4 py-2 text-sm font-medium ${m===o?"border-seagreen-500 bg-seagreen-50 text-seagreen-600 z-10":"border-gray-300 bg-white text-gray-700 hover:bg-gray-50"}`,children:o},o)})}),e.jsx("button",{onClick:()=>S(m+1),disabled:m===j,className:"relative inline-flex items-center rounded-md border border-gray-300 bg-white px-3 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"}),e.jsx("button",{onClick:()=>S(j),disabled:m===j,className:"relative inline-flex items-center rounded-md border border-gray-300 bg-white px-3 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Last"})]})]})})]})]})},Ae=x.memo(he);export{Ae as V};
//# sourceMappingURL=VesselList-XP8QIrO5.js.map
