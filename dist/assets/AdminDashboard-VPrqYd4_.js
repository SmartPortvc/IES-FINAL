import{j as e,C as q,F as A,B as O,v as $,c as M,s as R,e as V,f as B,u as Y,h as U,i as W}from"./index-DYPp-ivU.js";import{r}from"./vendor-BOKTEpvH.js";import{D as _}from"./DashboardLayout-CKQImzu3.js";import{a as z,b as G,E as J,A as k,I as K,c as Q,M as X,B as g}from"./ui-WwCSzw8y.js";import{P as Z,H as ee}from"./HodList-DaD7cm5B.js";import"./ErrorDisplay-CLSu7BDk.js";import"./DataTable-LWL9kMau.js";import"./StatusBadge-dur_AQpe.js";import"./formatters-CaoZFZze.js";const H=({title:m,onSubmit:a,fields:i,successMessage:n,emailSentMessage:o,linkValidityDays:u=7})=>{const[d,f]=r.useState({}),[w,b]=r.useState(!1),[y,v]=r.useState(!1),[p,h]=r.useState(""),[x,j]=r.useState(""),[N,S]=r.useState(!1),[l,E]=r.useState(!1),[I,D]=r.useState(""),P=r.useRef({}),F=(t,s)=>{f(c=>({...c,[t]:s}))},C=t=>{navigator.clipboard.writeText(t).then(()=>{E(!0),g.success("Registration link copied to clipboard!"),setTimeout(()=>E(!1),3e3)},s=>{console.error("Could not copy text: ",s),g.error("Failed to copy link")})},L=()=>{for(const s of i)if(s.required&&!d[s.name])return h(`${s.label} is required`),g.error(`${s.label} is required`),!1;const t=i.find(s=>s.type==="email");return t&&d[t.name]&&!$(d[t.name])?(h("Please enter a valid email address"),g.error("Please enter a valid email address"),!1):!0},T=async t=>{if(t.preventDefault(),!L())return;b(!0),h(""),v(!1),j(""),S(!1);const s=i.find(c=>c.type==="email");s&&D(d[s.name]);try{const c=await a(d);j(c.link),S(c.emailSent),v(!0),f({})}catch(c){console.error("Error submitting form:",c),h(`Failed: ${c.message||"Unknown error"}`),g.error("Failed. Please try again.")}finally{b(!1)}};return e.jsxs(q,{title:m,icon:e.jsx(X,{className:"h-6 w-6 text-seagreen-600"}),children:[y&&e.jsx("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(z,{className:"h-5 w-5 text-green-600 mr-2 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:n}),e.jsx("p",{className:"mt-1 text-sm",children:N?`${o} ${I}.`:"Please share the registration link."}),x&&e.jsxs("div",{className:"mt-4 p-3 bg-white rounded border border-gray-200",children:[e.jsx("p",{className:"text-sm font-medium text-gray-800 mb-1",children:"Registration Link:"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"text",value:x,readOnly:!0,className:"flex-1 text-sm p-2 border border-gray-300 rounded-l-md focus:outline-none"}),e.jsx("button",{onClick:()=>C(x),className:"bg-gray-200 text-gray-700 p-2 hover:bg-gray-300",title:"Copy to clipboard",children:e.jsx(G,{className:"h-5 w-5"})}),e.jsx("a",{href:x,target:"_blank",rel:"noopener noreferrer",className:"bg-seagreen-600 text-white p-2 rounded-r-md hover:bg-seagreen-700",title:"Open link",children:e.jsx(J,{className:"h-5 w-5"})})]}),l&&e.jsx("p",{className:"text-xs text-green-600 mt-1",children:"Link copied to clipboard!"}),e.jsxs("p",{className:"mt-2 text-xs text-gray-500",children:["This link will be valid for ",u," days."]})]})]})]})}),p&&e.jsx("div",{className:"bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded mb-4",children:e.jsxs("div",{className:"flex",children:[e.jsx(k,{className:"h-5 w-5 text-yellow-600 mr-2"}),e.jsx("span",{children:p})]})}),e.jsxs("form",{onSubmit:T,children:[e.jsx("div",{className:"space-y-4",children:i.map(t=>e.jsx(A,{id:t.name,label:t.label,required:t.required,helpText:t.helpText,icon:t.helpText?e.jsx(K,{className:"h-3 w-3 text-seagreen-600"}):void 0,children:e.jsx("input",{type:t.type,id:t.name,ref:s=>P.current[t.name]=s,value:d[t.name]||"",onChange:s=>F(t.name,s.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-seagreen-500",required:t.required})},t.name))}),e.jsx("div",{className:"mt-6",children:e.jsx(O,{type:"submit",loading:w,icon:e.jsx(Q,{className:"h-5 w-5"}),fullWidth:!0,children:"Send Invite"})})]})]})},te=()=>{const m=async a=>{const i=await M(a.portName,a.email),n=`${window.location.origin}/port-registration/${i}`;let o=!1;try{await R(i,a.portName,a.email),o=!0}catch(u){console.error("Email sending error:",u)}return{id:i,link:n,emailSent:o}};return e.jsx(H,{title:"Invite New Port",onSubmit:m,fields:[{name:"portName",label:"Port Name",type:"text",required:!0},{name:"email",label:"Port Email",type:"email",required:!0,helpText:"The invitation will be sent to this email address"}],successMessage:"Port invitation created successfully!",emailSentMessage:"An email with registration instructions has been sent to"})},se=()=>{const m=async a=>{const i=await V(a.email),n=`${window.location.origin}/hod-registration/${i}`;let o=!1;try{await B(i,a.email),o=!0}catch(u){console.error("Email sending error:",u)}return{id:i,link:n,emailSent:o}};return e.jsx(H,{title:"Invite Head of Department (HOD)",onSubmit:m,fields:[{name:"email",label:"HOD Email",type:"email",required:!0,helpText:"The invitation will be sent to this email address"}],successMessage:"HOD invitation created successfully!",emailSentMessage:"An email with registration instructions has been sent to"})},ue=()=>{const{userRole:m}=Y(),a=m==="hod",i=a?"details":"invite",[n,o]=r.useState(i),[u,d]=r.useState([]),[f,w]=r.useState([]),[b,y]=r.useState(!0),[v,p]=r.useState(!0),[h,x]=r.useState(null),[j,N]=r.useState(null);return r.useEffect(()=>{(async()=>{try{y(!0);const l=await U();d(l)}catch(l){console.error("Error fetching ports:",l),x("Failed to load port details")}finally{y(!1)}try{p(!0);const l=await W();w(l)}catch(l){console.error("Error fetching HODs:",l),N("Failed to load HOD details")}finally{p(!1)}})()},[]),e.jsxs(_,{title:"Admin Dashboard",subtitle:a?"View port details and information (read-only access)":"Manage ports and view their details",activeItem:n,setActiveItem:o,children:[a&&e.jsx("div",{className:"mb-6 bg-seagreen-50 border border-seagreen-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx(k,{className:"h-6 w-6 text-seagreen-600 mr-3 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-seagreen-800",children:"HOD View-Only Access"}),e.jsx("p",{className:"mt-1 text-sm text-seagreen-700",children:"You are logged in as a Head of Department with view-only access. You can view port details and HOD information but cannot make any changes."})]})]})}),n==="invite"&&!a&&e.jsx(te,{}),n==="details"&&e.jsx(Z,{ports:u,loading:b,error:h}),n==="inviteHod"&&!a&&e.jsx(se,{}),n==="hodList"&&e.jsx(ee,{hods:f,loading:v,error:j})]})};export{ue as default};
//# sourceMappingURL=AdminDashboard-VPrqYd4_.js.map
